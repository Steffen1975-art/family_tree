<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interaktiver Stammbaum - Familie Koller (Vollständige Daten)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* General body styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
            margin: 0;
            overflow: hidden; /* Prevent body scrollbars */
        }

        /* SVG container styling */
        #tree-container {
            width: 100vw;
            height: 100vh;
        }

        /* Styling for the connecting lines (links) */
        .link {
            fill: none;
            stroke: #94a3b8;
            stroke-width: 2px;
        }

        /* Styling for the person nodes (groups of circle and text) */
        .node {
            cursor: pointer;
            font-size: 14px;
        }

        .node circle {
            stroke: #0ea5e9;
            stroke-width: 2.5px;
            transition: fill 0.3s ease, transform 0.3s ease, stroke 0.3s ease;
        }
        
        .node.highlight circle {
            stroke: #e11d48; /* Rosy-500 for highlight */
            fill: #fecdd3;
        }

        .node text {
            font-weight: 500;
            paint-order: stroke;
            stroke: #f8fafc;
            stroke-width: 3.5px;
            stroke-linecap: butt;
            stroke-linejoin: miter;
        }
        
        .node:hover circle {
            transform: scale(1.1);
        }
        
        /* Controls for layout switching */
        .controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            z-index: 20;
            background-color: white;
            padding: 0.75rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            display: flex;
            flex-direction: column;
            gap: 0.75rem; /* Increased gap */
            max-height: 90vh;
            overflow-y: auto;
        }

        .controls .control-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .controls label {
            margin-right: 0.75rem;
            font-size: 0.875rem;
            font-weight: 500;
            white-space: nowrap;
        }

        .controls select, .controls input {
            border-radius: 6px;
            border: 1px solid #d1d5db;
            padding: 0.25rem 0.5rem;
            width: 110px; /* Give select a fixed width */
        }
        
        /* Search specific styles */
        #search-container {
            position: relative;
        }
        #search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #d1d5db;
            border-top: none;
            border-radius: 0 0 6px 6px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 30;
        }
        .search-result-item {
            padding: 0.5rem;
            cursor: pointer;
        }
        .search-result-item:hover {
            background-color: #f1f5f9;
        }


        /* Tooltip for displaying details on hover */
        .tooltip {
            position: absolute;
            text-align: left;
            padding: 12px;
            font-size: 0.875rem;
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            pointer-events: none; /* Allows mouse events to pass through */
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            max-width: 350px;
            z-index: 10;
        }

        .tooltip .name {
            font-weight: 700;
            color: #0c4a6e; /* text-sky-900 */
            font-size: 1rem;
            margin-bottom: 8px;
        }

        .tooltip .details p {
            margin: 4px 0;
        }

        .tooltip .details strong {
            color: #334155; /* text-slate-700 */
        }

    </style>
</head>
<body>

    <!-- Header Section -->
    <div class="absolute top-0 left-0 p-4 md:p-6 z-10 w-full bg-gradient-to-b from-white via-white/80 to-transparent pointer-events-none">
        <h1 class="text-2xl md:text-3xl font-bold text-sky-800">Ahnengalerie der Familie Koller</h1>
        <p class="text-slate-600 mt-1 text-sm md:text-base">Knoten anklicken zum Erweitern/Reduzieren. Zoomen und Verschieben mit Maus/Touch.</p>
    </div>

    <!-- UI Controls will be dynamically generated here -->
    <div id="controls-container" class="controls">
        <!-- JS will populate this -->
    </div>

    <!-- Container for the D3.js SVG visualization -->
    <div id="tree-container"></div>

    <!-- Tooltip element, hidden by default -->
    <div id="tooltip" class="tooltip">
        <div id="tooltip-name" class="name"></div>
        <div id="tooltip-details" class="details"></div>
    </div>

    <script>
        // The hierarchical data for the family tree, parsed from the PDF document.
        const familyData = {
            "name": "Johann Koller", "details": { "geboren": "1807", "gestorben": "02.09.1881", "info": "Heirat 1831 mit Franziska geb. Müller (1807-1892)." },
            "children": [
                { "name": "Xaver Koller", "details": { "geboren": "24.11.1832", "gestorben": "13.04.1919" } },
                {
                    "name": "Georg Koller", "details": { "geboren": "22.07.1843", "gestorben": "21.07.1928", "info": "Heirat 07.01.1873 mit Therese geb. Röck (1850-1923)." },
                    "children": [
                        {
                            "name": "Andreas Koller", "details": { "geboren": "01.01.1874", "gestorben": "10.05.1959", "info": "Heirat 02.05.1898 mit Therese geb. Stadler (1873-1960)." },
                            "children": [
                                { "name": "Therese Vogl", "details": { "geboren": "15.04.1899", "gestorben": "20.03.1974", "info": "geb. Koller. Heirat 19.10.1921 mit Xaver Vogl (1897-1958)." } },
                                { "name": "Andreas Koller", "details": { "geboren": "29.11.1902", "gestorben": "14.04.1944", "info": "Heirat 23.11.1925 mit Maria geb. Schreil (1901-1944)." } },
                                { "name": "Franz-Xaver Koller", "details": { "geboren": "20.05.1904", "gestorben": "05.04.1962", "info": "Heirat 22.10.1928 mit Thekla geb. Vogl (1900-1974)." } },
                                { "name": "Franziska Koller", "details": { "geboren": "04.07.1906", "gestorben": "unbekannt" } },
                                { "name": "Maria Koller", "details": { "geboren": "06.12.1907", "gestorben": "unbekannt" } },
                                { "name": "Max Koller", "details": { "geboren": "25.09.1910", "gestorben": "06.11.1937", "info": "Heirat 24.05.1937 mit Johanna geb. Englmeier (1914-unbekannt)." } },
                            ]
                        },
                        { "name": "Georg Koller", "details": { "geboren": "26.02.1876", "gestorben": "04.10.1954", "info": "Heirat mit Centa (Daten unbekannt)." }, "children": [
                            { "name": "Georg Koller", "details": { "info": "Daten unbekannt." } },
                            { "name": "Willibald Koller", "details": { "info": "Daten unbekannt." } }
                        ]},
                        {
                            "name": "Franz Koller", "details": { "geboren": "19.03.1878", "gestorben": "09.11.1933", "info": "Heirat 26.01.1902 mit Anna geb. Weikl (1882-1928)." },
                            "children": [
                                { "name": "Anna Wölfl", "details": { "geboren": "12.08.1902", "gestorben": "12.08.1989", "info": "geb. Koller. Heirat 25.11.1926 mit Michael Wölfl (1901-1981)." } },
                                { "name": "Wilhelmine Kroner", "details": { "geboren": "29.09.1903", "gestorben": "20.01.1988", "info": "geb. Koller. Heirat 16.11.1933 mit Johann Kroner (1903-1969)." } },
                                { "name": "Therese Weinberger", "details": { "geboren": "31.01.1905", "gestorben": "28.02.1964", "info": "geb. Koller. Heirat 11.11.1926 mit Franz Weinberger (1901-1974)." } },
                                { "name": "Franz Koller", "details": { "geboren": "04.10.1906", "gestorben": "vermisst 1945", "info": "Heirat 04.02.1935 mit Veronika geb. Kroner (1909-1969)." } },
                                { "name": "Georg Koller", "details": { "geboren": "09.01.1908", "gestorben": "24.09.1991", "info": "Heirat 21.04.1958 mit Anna geb. Wühr (1919-2005)." } },
                                { "name": "Heinrich Koller", "details": { "geboren": "22.06.1909", "gestorben": "04.05.1986" } },
                                { "name": "Andreas Koller", "details": { "geboren": "15.10.1910", "gestorben": "16.11.1944" } },
                                { "name": "Ludwig Koller", "details": { "geboren": "24.08.1912", "gestorben": "06.01.1976", "info": "Heirat 07.02.1936 mit Wilhelmine geb. Stoiber (1912-1994)." } },
                                { "name": "Maria Koller", "details": { "geboren": "15.01.1914", "gestorben": "22.10.1915" } },
                                { "name": "Maria-Josefa Koller", "details": { "geboren": "17.09.1915" } },
                                { "name": "Babette Koller", "details": { "geboren": "10.02.1917" } },
                                { "name": "Rosa Koller", "details": { "geboren": "14.11.1918", "gestorben": "09.05.1987" } },
                                { "name": "Frieda Koller", "details": { "geboren": "18.06.1921" } },
                                { "name": "Pauline Koller", "details": { "geboren": "16.11.1924" } }
                            ]
                        },
                        { "name": "Baptist Koller", "details": { "geboren": "20.06.1880", "gestorben": "27.08.1963", "info": "Heirat mit Berta geb. Wenzl (1882-1961)." }, "children": [
                            { "name": "Baptist Koller", "details": { "geboren": "20.07.1902", "gestorben": "18.04.1972", "info": "Heirat 01.10.1930 mit Sophie Hinkofer (1906-1987)." } }
                        ]},
                        {
                            "name": "Tobias Koller", "details": { "geboren": "10.09.1882", "gestorben": "18.01.1965", "info": "1. Ehe (24.09.1906) mit Cäzilia geb. Weber (1883-1916). 2. Ehe (22.04.1918) mit Maria Treml (1892-1980)." },
                            "children": [
                                { "name": "Tobias Koller", "details": { "geboren": "22.05.1907", "gestorben": "13.06.1922", "info": "Aus 1. Ehe." } },
                                { "name": "Cäzilia Koller", "details": { "geboren": "08.10.1908", "gestorben": "13.07.1991", "info": "Aus 1. Ehe." } },
                                { "name": "Georg Koller", "details": { "geboren": "08.03.1910", "gestorben": "14.09.1992", "info": "Aus 1. Ehe. Heirat 03.07.1946 mit Agnes geb. Wühr (geb. 1920)." } },
                                { "name": "Baptist Koller", "details": { "geboren": "26.05.1911", "gestorben": "14.01.1912", "info": "Aus 1. Ehe." } },
                                { "name": "Michael Koller", "details": { "geboren": "28.09.1912", "gestorben": "01.07.1999", "info": "Aus 1. Ehe. Heirat 14.09.1947 mit Cäzilia geb. Weikl (1916-2007)." } },
                                { "name": "Therese Koller", "details": { "geboren": "21.11.1914", "gestorben": "09.07.1915", "info": "Aus 1. Ehe." } },
                                { "name": "Johann-Baptist Koller", "details": { "geboren": "19.02.1919", "gestorben": "vermisst 04.08.1942", "info": "Aus 2. Ehe." } },
                                { "name": "Maximilian Koller", "details": { "geboren": "16.10.1920", "gestorben": "09.01.1980", "info": "Aus 2. Ehe. Heirat 23.03.1945 mit Margarete geb. Wührer (geb. 1923)." } },
                                { "name": "Josef Koller", "details": { "geboren": "25.02.1922", "gestorben": "03.03.1997", "info": "Aus 2. Ehe. Heirat 14.09.1950 mit Mathilde geb. Brem (1925-1998)." } },
                                { "name": "Maria Koller", "details": { "geboren": "15.05.1923", "gestorben": "03.06.1924", "info": "Aus 2. Ehe." } },
                                { "name": "Maria Koller", "details": { "geboren": "16.08.1924", "gestorben": "25.03.2013", "info": "Aus 2. Ehe." } },
                                { "name": "Berta Wurzer", "details": { "geboren": "13.08.1925", "info": "geb. Koller, aus 2. Ehe. Heirat 29.04.1948 mit Alois Wurzer (1919-2005)." } },
                                { "name": "Erwin Koller", "details": { "geboren": "19.03.1927", "gestorben": "06.10.1927", "info": "Aus 2. Ehe." } },
                                { "name": "Elisabeth Koller", "details": { "geboren": "18.04.1928", "gestorben": "27.12.1928", "info": "Aus 2. Ehe." } },
                                { "name": "August Koller", "details": { "geboren": "30.09.1929", "info": "Aus 2. Ehe. Heirat 10.09.1952 mit Sophie geb. Koller (1932-2011)." } },
                                { "name": "Reinhold Koller", "details": { "geboren": "16.05.1932", "gestorben": "17.01.1933", "info": "Aus 2. Ehe." } }
                            ]
                        },
                        {
                            "name": "Willibald Koller", "details": { "geboren": "13.09.1883", "gestorben": "15.11.1964", "info": "Heirat 06.08.1906 mit Maria geb. Egner (1882-1956)." },
                            "children": [
                                { "name": "Maria Mohr", "details": { "geboren": "19.01.1905", "gestorben": "14.03.1983", "info": "geb. Egner. Heirat 31.01.1931 mit Jakob Mohr (1901-1974)." } },
                                { "name": "Willibald Koller", "details": { "geboren": "08.05.1907", "gestorben": "23.10.1944", "info": "Heirat 17.01.1929 mit Maria geb. Bergmann (1904-1951)." } },
                                { "name": "Katharina Bauer", "details": { "geboren": "29.07.1908", "gestorben": "14.04.1990", "info": "geb. Koller. Heirat 1928 mit Andreas Bauer (1904-1944)." } },
                                { "name": "Johann Baptist Koller", "details": { "geboren": "25.10.1910", "gestorben": "01.05.1945", "info": "Heirat 30.08.1933 mit Mathilde geb. Bachl (geb. 1910)." } },
                                { "name": "Therese Krauß", "details": { "geboren": "05.04.1912", "gestorben": "10.11.1999", "info": "geb. Koller. Heirat 12.11.1932 mit Georg-Walter Krauß (1908-1936)." } },
                                { "name": "Johanna Koller", "details": { "geboren": "31.07.1913", "gestorben": "03.06.1915" } },
                                { "name": "Georg Koller", "details": { "geboren": "13.12.1914", "info": "1. Heirat 30.08.1939 (geschieden 14.07.1948) mit Margarethe geb. Seiler (1914-1992). 2. Heirat mit Anni geb. Ries (geb. 1920)." } },
                                { "name": "Angela Best", "details": { "geboren": "27.06.1916", "info": "geb. Koller. Heirat 15.06.1940 mit Julius Emil Best (1914-1986)." } },
                                { "name": "Josef Koller", "details": { "geboren": "11.09.1919", "gestorben": "18.06.1924" } },
                                { "name": "Oskar Koller", "details": { "geboren": "01.01.1921", "gestorben": "01.01.1921" } },
                                { "name": "Johanna Schlagintweit", "details": { "geboren": "22.08.1922", "gestorben": "18.10.2008", "info": "geb. Koller. Heirat 01.02.1950 mit Maximilian Schlagintweit (1912-1986)." } },
                                { "name": "Franz Koller", "details": { "geboren": "15.11.1923", "info": "Heirat 02.01.1950 mit Frieda geb. Bauer (1925-2002)." } }
                            ]
                        },
                        {
                            "name": "Ludwig Koller", "details": { "geboren": "16.01.1886", "gestorben": "26.01.1974", "info": "Heirat 08.05.1911 mit Amalie geb. Brandl (1887-1969)." },
                            "children": [
                                { "name": "Amalie Stern", "details": { "geboren": "13.02.1912", "gestorben": "25.01.2003", "info": "geb. Koller. Heirat Nov. 1941 mit Michael Stern (1911-1944)." } },
                                { "name": "Ludwig Koller", "details": { "geboren": "15.03.1913", "gestorben": "27.02.1944", "info": "Heirat 18.02.1938 mit Ursula geb. Kumpfmüller (1910-1997)." } },
                                { "name": "Franz-Xaver Koller", "details": { "geboren": "14.02.1915", "gestorben": "23.03.1915" } },
                                { "name": "Anna Koller", "details": { "geboren": "16.08.1919", "gestorben": "06.08.1920" } },
                                { "name": "Anna Koller", "details": { "geboren": "22.04.1922", "gestorben": "26.11.1926" } },
                                { "name": "Xaver Koller", "details": { "geboren": "06.10.1929", "gestorben": "06.04.1991" } }
                            ]
                        },
                        {
                            "name": "Josef Koller", "details": { "geboren": "13.03.1888", "gestorben": "30.10.1958", "info": "Heirat 13.07.1920 mit Johanna geb. Graßl (1891-1970)." },
                            "children": [
                                { "name": "Maria Weikl", "details": { "geboren": "08.09.1912", "info": "geb. Koller. Heirat 13.09.1933 mit Josef Weikl (1908-1986)." } },
                                { "name": "Josef Koller", "details": { "geboren": "03.12.1921", "gestorben": "28.12.1984", "info": "Heirat 26.10.1949 mit Anna geb. Kollmeier (1924-2009)." } },
                                { "name": "Johanna Koller", "details": { "geboren": "1923", "gestorben": "1923" } },
                                { "name": "Johanna Stadlinger", "details": { "geboren": "18.07.1924", "info": "geb. Koller. Heirat 30.08.1964 mit Johann Stadlinger (1923-1997)." } },
                                { "name": "Aloisia Blum", "details": { "geboren": "17.12.1925", "info": "geb. Koller. Heirat 03.10.1952 mit Friedrich Blum (geb. 1925)." } },
                                { "name": "Willibald Koller", "details": { "geboren": "18.04.1927", "gestorben": "21.02.1975" } },
                                { "name": "Martha Weikl", "details": { "geboren": "24.05.1928", "info": "geb. Koller. 1. Heirat 14.06.1951 mit Franz-Xaver Weikl (1926-1971). 2. Heirat 29.08.1975 mit Johann Stadler (geb. 1922)." } },
                                { "name": "Erna Koller", "details": { "geboren": "20.08.1931" } }
                            ]
                        },
                        { "name": "Max Koller", "details": { "geboren": "20.04.1889", "gestorben": "11.03.1890" } },
                        { "name": "Therese Treml", "details": { "geboren": "12.08.1890", "gestorben": "27.08.1976", "info": "geb. Koller. Heirat 1920 mit August Treml (1896-1975)." }, "children": [
                            { "name": "Therese Koller", "details": { "geboren": "29.08.1919", "gestorben": "11.04.2012", "info": "Heirat 28.04.1947 mit Johann Rosenlehner (1912-1981)." } },
                            { "name": "August Treml", "details": { "geboren": "06.05.1921", "gestorben": "vermisst 22.12.1941" } },
                            { "name": "Anna Bauer", "details": { "geboren": "10.10.1922", "gestorben": "11.09.2008", "info": "geb. Treml. Heirat 03.01.1951 mit Josef Bauer (1929-1991)." } },
                            { "name": "Elisabeth Treml", "details": { "geboren": "11.10.1923", "gestorben": "11.04.1925" } }
                        ]},
                        {
                            "name": "Sylvester Koller", "details": { "geboren": "23.07.1893", "gestorben": "24.03.1974", "info": "Heirat 06.03.1916 mit Mathilde geb. Hinkofer (1895-1974)." },
                            "children": [
                                { "name": "Sylvester Koller", "details": { "geboren": "07.02.1917", "gestorben": "26.05.1937", "info": "Vom Blitz getroffen." } },
                                {
                                    "name": "Wolfgang Koller", "details": { "geboren": "30.10.1918", "gestorben": "04.02.1996", "info": "Heirat 24.01.1946 mit Rosina geb. Adam (1922-1999)." },
                                    "children": [
                                        { "name": "Renate Weikl", "details": { "geboren": "13.12.1944", "info": "geb. Adam. Heirat 06.08.1963 mit Franz Xaver Weikl (geb. 1938)." }, "children": [
                                            {"name": "Franz-Josef Weikl", "details": {"geboren": "13.01.1964", "info": "Heirat 23.09.1989 mit Elisabeth geb. Kramer (geb. 1965)."}, "children": [
                                                {"name": "Jakob Johannes Weikl", "details": {"geboren": "08.02.1992"}},
                                                {"name": "Katharina Elisabeth Weikl", "details": {"geboren": "10.09.2001"}}
                                            ]},
                                            {"name": "Sonja Pauli", "details": {"geboren": "08.04.1966", "info": "geb. Weikl. Heirat 14.11.1988 mit Werner Pauli (geb. 1968)."}, "children": [
                                                {"name": "Benjamin Pauli", "details": {"geboren": "12.03.1989"}},
                                                {"name": "Sabrina Pauli", "details": {"geboren": "18.06.1991"}}
                                            ]}
                                        ]},
                                        { "name": "Wolfgang Koller", "details": { "geboren": "06.03.1947", "info": "Heirat 11.04.1970 mit Marille geb. Freimuth (geb. 1953)." }, "children": [
                                            {"name": "Wolfgang Koller", "details": {"geboren": "28.10.1974", "info": "Partnerinnen: Tanja Jungbeck (geb. 1977), Katrin Schreiner (geb. 1986)."}, "children": [
                                                {"name": "Milena Jungbeck", "details": {"geboren": "28.02.2004", "info": "Tochter mit Tanja Jungbeck."}}
                                            ]},
                                            {"name": "Yvonne Koller", "details": {"geboren": "04.05.1977"}}
                                        ]},
                                        { "name": "Rupert Koller", "details": { "geboren": "26.05.1950", "info": "1. Heirat 20.10.1973 (geschieden 23.05.1995) mit Elvira Franziska geb. Ziemer (geb. 1954). 2. Heirat 28.11.1997 mit Renate Maria geb. Fuchs (geb. 1963)." }, "children": [
                                            {"name": "Alexandra Koller", "details": {"geboren": "24.06.1974", "info": "Tochter von Elvira."}},
                                            {"name": "Christina Koller", "details": {"geboren": "27.04.1978", "info": "Tochter von Elvira."}},
                                            {"name": "Rupert Koller", "details": {"geboren": "07.03.1989", "info": "Sohn von Elvira."}},
                                            {"name": "Mathias Eduard Josef Baur (Stiefsohn)", "details": {"geboren": "20.06.1990", "info": "Sohn von Renate."}}
                                        ]},
                                        { "name": "Willibald Siegfried Koller", "details": { "geboren": "01.12.1951", "info": "Heirat 05.09.1975 mit Paula Roswitha geb. Schlagintweit (geb. 1955)." }, "children": [
                                            {"name": "Daniel Karl Koller", "details": {"geboren": "24.04.1982"}},
                                            {"name": "Christoph Willibald Koller", "details": {"geboren": "05.04.1984"}}
                                        ]},
                                        { "name": "Karl Josef Koller", "details": { "geboren": "13.11.1955", "info": "Heirat 10.05.1980 mit Isolde Brigitte geb. Geiger (geb. 1960)." }, "children": [
                                            {"name": "Dominik Karl Koller", "details": {"geboren": "10.05.1982"}}
                                        ]},
                                        { "name": "Anton Wilhelm Koller", "details": { "geboren": "02.07.1959", "info": "Heirat 04.06.1985 (geschieden) mit Heidi Gabriele geb. Pöschl (geb. 1963). Lebensgefährtin Gabriela Dackelmann (geb. 1954)." }, "children": [
                                            {"name": "Nadine Catrin Helga Rosalie Koller", "details": {"geboren": "03.06.1986"}},
                                            {"name": "Ricarda Gabriela Koller", "details": {"geboren": "15.08.1989"}}
                                        ]}
                                    ]
                                },
                                { "name": "Maria Koller", "details": { "geboren": "03.01.1920", "gestorben": "16.03.1920" } },
                                {
                                    "name": "Alois Koller", "details": { "geboren": "03.02.1922", "gestorben": "04.05.1982", "info": "Partnerin Therese Brunner (1914-2009). Heirat 05.02.1947 mit Anna geb. Drexler (1915-2003)." },
                                    "children": [
                                        {"name": "Willibald Weinberger", "details": {"geboren": "22.01.1947", "info": "Sohn von Therese Brunner. Heirat 24.10.1969 mit Irene Veronika geb. Marscholek (geb. 1950)."}, "children": [
                                            {"name": "Michaela Schmöller", "details": {"geboren": "17.07.1971", "info": "geb. Weinberger. 1. Heirat (geschieden) mit Klaus Hermann Weikl. 2. Heirat 22.05.2004 mit Thorsten Schmöller."}, "children": [
                                                {"name": "Miriam Theresa Weikl", "details": {"geboren": "12.03.1992"}},
                                                {"name": "Alexander Klaus Weikl", "details": {"geboren": "03.05.1993"}}
                                            ]}
                                        ]},
                                        {"name": "Anneliese Elisabeth Wölfl", "details": {"geboren": "15.05.1936", "info": "geb. Wölfl. Tochter von Anna. Heirat 26.04.1960 mit Erich Josef Wölfl (1934-2005)."}, "children": [
                                            {"name": "Bernhard Wölfl", "details": {"geboren": "03.02.1959", "info": "Heirat 07.05.1983 mit Christl geb. Schreiner (geb. 1960)."}},
                                            {"name": "Karin Christina Wölfl", "details": {"geboren": "15.06.1963"}, "children": [
                                                {"name": "Katharina Anna Wölfl", "details": {"geboren": "17.03.1993"}}
                                            ]},
                                            {"name": "Annette Wölfl", "details": {"geboren": "26.01.1975"}}
                                        ]},
                                        {"name": "Helene Seidl", "details": {"geboren": "29.10.1938", "info": "geb. Wölfl. Tochter von Anna. Heirat 15.02.1963 mit Dietmar Seidl (geb. 1941)."}, "children": [
                                            {"name": "Brigitte Hildegard Seidl", "details": {"geboren": "04.07.1963"}},
                                            {"name": "Christine Regler", "details": {"geboren": "04.08.1965", "info": "geb. Seidl. Heirat 26.04.1989 mit Willibald Regler (geb. 1963)."}, "children": [
                                                {"name": "Miriam Regler", "details": {"geboren": "24.05.1989"}}
                                            ]}
                                        ]},
                                        {"name": "Alois Koller", "details": {"geboren": "30.08.1947", "info": "Sohn von Anna. Heirat 30.08.1968 mit Monika Brigitte geb. Windel (geb. 1949)."}, "children": [
                                            {"name": "Sabine Renate Koller", "details": {"geboren": "02.12.1968"}}
                                        ]}
                                    ]
                                },
                                { "name": "Siegfried Koller", "details": { "geboren": "16.08.1923", "gestorben": "01.07.1981", "info": "Heirat 09.05.1951 mit Katharina geb. Hutterer (1921-1991)." }, "children": [
                                    {"name": "Manfred Josef Koller", "details": {"geboren": "12.02.1949"}},
                                    {"name": "Veronika Maria Holzapfel", "details": {"geboren": "17.02.1952", "info": "geb. Koller. Heirat mit Ludwig Holzapfel (1951-1987). Lebensgefährte Gerhard Barth (geb. 1949)."}, "children": [
                                        {"name": "Stefan Ludwig Holzapfel", "details": {"geboren": "29.01.1974"}}
                                    ]},
                                    {"name": "Sieglinde Mathilde Robl", "details": {"geboren": "15.11.1953", "info": "geb. Koller. Heirat 15.03.1978 mit Franz Xaver Robl (geb. 1950)."}, "children": [
                                        {"name": "Carolin Raith", "details": {"geboren": "15.01.1981", "info": "geb. Robl. Heirat 16.07.2004 mit Günther Raith (geb. 1978)."}, "children": [
                                            {"name": "Johannes Raith", "details": {"geboren": "01.01.2007"}}
                                        ]}
                                    ]},
                                    {"name": "Maria Anna Benesch", "details": {"geboren": "08.06.1957", "info": "geb. Koller. Heirat mit Alfred Benesch (1949-2003). Lebensgefährte Karl-Heinz Halfar (geb. 1965)."}, "children": [
                                        {"name": "Marianne Benesch", "details": {"geboren": "11.07.1979", "info": "Lebensgefährte Franz Strohmeier (geb. 1966)."}, "children": [
                                            {"name": "Thomas Alfred Strohmeier", "details": {"geboren": "12.09.2004"}}
                                        ]},
                                        {"name": "Monika Geiger", "details": {"geboren": "29.11.1981", "info": "geb. Benesch. Heirat 09.09.2005 mit Ralph Geiger (geb. 1979)."}, "children": [
                                            {"name": "Vanessa Maria Geiger", "details": {"geboren": "03.12.2004"}},
                                            {"name": "Felix Gabriel Geiger", "details": {"geboren": "31.03.2006"}}
                                        ]}
                                    ]},
                                    {"name": "Eva Katharina Stadler", "details": {"geboren": "16.12.1959", "info": "geb. Koller. Heirat 24.10.1980 mit Alfons Stadler (geb. 1953)."}, "children": [
                                        {"name": "Wolfgang Stadler", "details": {"geboren": "26.10.1981"}},
                                        {"name": "Thomas Stadler", "details": {"geboren": "01.06.1987"}}
                                    ]}
                                ]},
                                { "name": "Mathilde Wölfl", "details": { "geboren": "17.04.1925", "gestorben": "24.10.1980", "info": "geb. Koller. Heirat 1949 mit Ernst Wölfl (1910-1986)." }, "children": [
                                    {"name": "Emil Wölfl", "details": {"geboren": "10.06.1949", "info": "Heirat 10.05.1991 mit Sieglinde geb. Süss (geb. 1947)."}}
                                ]},
                                { "name": "Friedrich Koller", "details": { "geboren": "19.02.1927", "gestorben": "13.01.1993", "info": "Heirat 16.02.1949 mit Rosa geb. Tschada (1927-2007)." }, "children": [
                                    {"name": "Friedrich Koller", "details": {"geboren": "12.09.1950", "info": "Heirat 20.12.1975 mit Christa geb. Luksch (geb. 1954)."}, "children": [
                                        {"name": "Birgit Koller", "details": {"geboren": "19.09.1978"}},
                                        {"name": "Matthias Friedrich Adalbert Koller", "details": {"geboren": "26.01.1985"}}
                                    ]},
                                    {"name": "Monika Gollis", "details": {"geboren": "04.04.1959", "info": "geb. Koller. Heirat 01.12.1979 mit Max Gollis (geb. 1956)."}, "children": [
                                        {"name": "Marco Max Gollis", "details": {"geboren": "08.05.1980"}},
                                        {"name": "Sabine Monika Gollis", "details": {"geboren": "26.08.1983", "gestorben": "31.08.2003"}},
                                        {"name": "Maximilian Friedrich Gollis", "details": {"geboren": "09.08.1991"}}
                                    ]}
                                ]},
                                {
                                    "name": "Maria Hubert", "details": { "geboren": "19.04.1928", "info": "geb. Koller. Lebensgefährte Franz Xaver Schreiner (1919-1972). Heirat 10.05.1958 mit Alfons Georg Hubert (1907-1997)." },
                                    "children": [
                                        { "name": "Sylvester Koller", "details": { "geboren": "08.04.1949", "info": "Sohn von Franz Schreiner. Heirat 08.09.1972 mit Christa Pauline Holl (1951-2012)." }, "children": [
                                            {"name": "Thomas Koller", "details": {"geboren": "12.08.1973", "gestorben": "13.11.2003"}},
                                            {"name": "Steffen Koller", "details": {"geboren": "09.08.1975", "info": "Heirat 03.06.2011 mit Mareike geb. Maier (geb. 1981)."}, "children": [
                                                {"name": "Madita Pauline Koller", "details": {"geboren": "06.02.2013"}},
                                                {"name": "Elva Koller", "details": {"geboren": "01.12.2014"}}
                                            ]}
                                        ]},
                                        { "name": "Anton Koller", "details": { "geboren": "08.01.1952", "gestorben": "28.03.1954", "info": "Sohn von Franz Schreiner." } },
                                        { "name": "Antonia Rita Bauer", "details": { "geboren": "27.12.1958", "info": "geb. Hubert. Tochter von Alfons Hubert. Heirat 05.11.1958 mit Otmar Bauer (geb. 1957)." }, "children": [
                                            {"name": "Christian Udo Bauer", "details": {"geboren": "05.02.1977", "info": "Heirat 10.09.2010 mit Tatiana Diara (geb. 1980)."}},
                                            {"name": "Alexandra Gisela Tonia Bauer", "details": {"geboren": "02.11.1978"}},
                                            {"name": "Andreas Georg Otmar Bauer", "details": {"geboren": "18.09.1982"}}
                                        ]},
                                        { "name": "Daniela Mathilde Holl", "details": { "geboren": "27.12.1958", "info": "geb. Hubert. Tochter von Alfons Hubert. Heirat 10.05.1979 (geschieden) mit Ernst Ludwig Holl (geb. 1946)." }, "children": [
                                            {"name": "Carolin Binder", "details": {"geboren": "24.10.1979", "info": "geb. Holl. Heirat 09.05.2010 mit Gottfried Binder (geb. 1981)."}, "children": [
                                                {"name": "Jana Binder", "details": {"geboren": "25.08.2010"}},
                                                {"name": "Luis Binder", "details": {"geboren": "24.02.2013"}}
                                            ]},
                                            {"name": "Susanne Casper", "details": {"geboren": "27.01.1981", "info": "geb. Holl. Heirat 10.05.2007 mit Klaus Casper (geb. 1971)."}, "children": [
                                                {"name": "Alexander Daniel Casper", "details": {"geboren": "03.05.2010"}}
                                            ]},
                                            {"name": "Michaela Wieser", "details": {"geboren": "24.11.1983", "info": "geb. Holl. Heirat 14.09.2013 mit Tino Wieser (geb. 1975)."}}
                                        ]}
                                    ]
                                },
                                { "name": "Lieselotte Anna Koller", "details": { "geboren": "15.06.1929", "gestorben": "05.03.1930" } },
                                { "name": "Regina Bartimäß", "details": { "geboren": "06.09.1933", "info": "geb. Koller. Heirat 20.08.1954 mit Günther Bartimäß (geb. 1929)." }, "children": [
                                    {"name": "Karl-Heinz Bartimäß", "details": {"geboren": "13.02.1954", "gestorben": "20.07.2006", "info": "1. Heirat (geschieden) mit Brigitte Kilkis. 2. Heirat mit Inge Gabriel."}, "children": [
                                        {"name": "Michael Punzet", "details": {"geboren": "06.07.1980", "info": "geb. Bartimäß. Heirat 16.07.2005 mit Tanja Punzet (geb. 1984)."}},
                                        {"name": "Jutta Bartimäß", "details": {"geboren": "13.09.1982", "info": "Heirat (geschieden) mit Markus Kohlhaus. Lebensgefährte Robert Lapenna."}, "children": [
                                            {"name": "Madleine Bartimäß", "details": {"geboren": "22.05.2009"}}
                                        ]}
                                    ]},
                                    {"name": "Gabriele Fink", "details": {"geboren": "02.09.1957", "info": "geb. Bartimäß. Heirat (geschieden) mit Gerhard Fink (geb. 1953)."}, "children": [
                                        {"name": "Florian Fink", "details": {"geboren": "13.05.1980"}}
                                    ]},
                                    {"name": "Günther Helmut Bartimäß", "details": {"geboren": "12.12.1961", "info": "Heirat 23.05.1986 mit Ulrike geb. Riedl (geb. 1965)."}, "children": [
                                        {"name": "Daniel Günther Bartimäß", "details": {"geboren": "05.05.1989"}},
                                        {"name": "Sandra Doris Bartimäß", "details": {"geboren": "09.08.1991"}}
                                    ]}
                                ]},
                                { "name": "Therese Androwick", "details": { "geboren": "15.10.1934", "info": "geb. Koller. Heirat 10.12.1955 mit William Androwick (geb. 1932)." }, "children": [
                                    {"name": "William Victor Androwick", "details": {"geboren": "01.03.1957", "info": "Heirat 19.12.1981 mit Theresa Luise Cowan (geb. 1960)."}, "children": [
                                        {"name": "William Josef Androwick", "details": {"geboren": "03.02.1982"}},
                                        {"name": "Michelle Lynn Androwick", "details": {"geboren": "24.08.1984"}},
                                        {"name": "Emily Rae Androwick", "details": {"geboren": "08.11.1989"}}
                                    ]},
                                    {"name": "Rita Therese Gamache", "details": {"geboren": "22.12.1959", "info": "geb. Androwick. Heirat 01.10.1988 mit Gary Lance Gamache (geb. 1955)."}, "children": [
                                        {"name": "Heidi Marie Gamache", "details": {"geboren": "14.06.1989"}},
                                        {"name": "Britta Koller-Gamache", "details": {"geboren": "04.06.1992"}},
                                        {"name": "Krista Androwick-Gamache", "details": {"geboren": "17.01.1998"}}
                                    ]},
                                    {"name": "Heidi Marie Androwick", "details": {"geboren": "12.10.1961"}},
                                    {"name": "Christine Regina Fredricksen", "details": {"geboren": "18.11.1967", "info": "geb. Androwick. 1. Heirat (geschieden) mit Peter Andrew Voss. 2. Heirat 16.09.1993 mit David Fredricksen (geb. 1965)."}, "children": [
                                        {"name": "Erik David Fredricksen", "details": {"geboren": "24.09.1994"}},
                                        {"name": "Marc Douglas Fredricksen", "details": {"geboren": "13.05.1999"}},
                                        {"name": "Medison Bonolaise Fredricksen", "details": {"geboren": "28.01.2002"}}
                                    ]}
                                ]},
                                { "name": "Rita Wölfl", "details": { "geboren": "29.01.1937", "info": "geb. Koller. Heirat 11.11.1957 mit Ernst Wölfl (geb. 1936)." }, "children": [
                                    {"name": "Ernst Wölfl", "details": {"geboren": "26.03.1962", "info": "Heirat 07.01.1983 mit Christine Hackl (geb. 1960)."}, "children": [
                                        {"name": "Tobias Wölfl", "details": {"geboren": "06.05.1986"}},
                                        {"name": "Markus Wölfl", "details": {"geboren": "12.09.1988"}}
                                    ]},
                                    {"name": "Klaus Wölfl", "details": {"geboren": "11.01.1966", "info": "Heirat (geschieden) mit Margit Zellner (geb. 1970). Lebensgefährtin Svenja Schwarz (geb. 1978)."}, "children": [
                                        {"name": "Luis Schwarz", "details": {"geboren": "09.03.2011"}},
                                        {"name": "Emmi Schwarz", "details": {"geboren": "21.09.2012"}}
                                    ]},
                                    {"name": "Claudia Rita Stoiber", "details": {"geboren": "16.02.1971", "info": "geb. Wölfl. Heirat 18.09.1998 mit Johann Franz Stoiber (geb. 1967)."}, "children": [
                                        {"name": "Maximilian Stoiber", "details": {"geboren": "02.11.2000"}},
                                        {"name": "Christina Stoiber", "details": {"geboren": "08.08.2003"}}
                                    ]}
                                ]},
                                { "name": "Jakob Koller", "details": { "geboren": "10.06.1941", "gestorben": "18.03.2013", "info": "Heirat 15.11.1962 mit Rosa Neumeier (geb. 1940)." }, "children": [
                                    {"name": "Silvia Rita Schneider", "details": {"geboren": "14.05.1963", "info": "geb. Koller. Heirat (geschieden) mit Gernot Günther Schneider (geb. 1960). Lebensgefährte Rainer Grabs (geb. 1961)."}},
                                    {"name": "Martin Koller", "details": {"geboren": "24.04.1964", "info": "Heirat 22.06.1994 mit Margit Katharina (geb. 1966)."}, "children": [
                                        {"name": "Andreas Koller", "details": {"geboren": "25.09.1996"}}
                                    ]},
                                    {"name": "Rosa Therese Weinberger", "details": {"geboren": "05.08.1965", "info": "geb. Koller. Heirat 19.06.1987 mit Johann Weinberger (geb. 1963)."}, "children": [
                                        {"name": "Alexander Weinberger", "details": {"geboren": "07.05.1988"}},
                                        {"name": "Michael Weinberger", "details": {"geboren": "04.07.1990"}}
                                    ]},
                                    {"name": "Angelika Koller", "details": {"geboren": "26.05.1968"}}
                                ]},
                                { "name": "Franziska Rettenberger", "details": { "geboren": "01.01.1943", "info": "geb. Koller. Heirat mit Josef Herbert Rettenberger (1940-2000). Lebensgefährte Günter Ellerbeck (geb. 1944)." }, "children": [
                                    {"name": "Josef Herbert Rettenberger", "details": {"geboren": "18.03.1962", "info": "Heirat 29.07.1983 mit Ulrike Wallner (geb. 1963)."}, "children": [
                                        {"name": "Martin Rettenberger", "details": {"geboren": "30.07.1990"}}
                                    ]},
                                    {"name": "Anton Alfred Rettenberger", "details": {"geboren": "13.09.1964", "info": "Heirat (geschieden) mit Petra Hilbert (geb. 1967). Lebensgefährtin Dagmar Maria Zellner (geb. 1971)."}, "children": [
                                        {"name": "Florian Rettenberger", "details": {"geboren": "04.07.1989"}},
                                        {"name": "Susanne Rettenberger", "details": {"geboren": "07.04.1992"}},
                                        {"name": "Anna Rettenberger", "details": {"geboren": "12.06.2011"}}
                                    ]}
                                ]}
                            ]
                        }
                    ]
                },
                { "name": "Katharina Haller", "details": { "geboren": "23.04.1845", "gestorben": "01.07.1914", "info": "geb. Koller. Heirat 10.11.1873 mit Franz-Xaver Haller (1842-1901)." } },
                { "name": "Franziska Stern", "details": { "geboren": "15.12.1863", "gestorben": "01.02.1927", "info": "geb. Koller. Heirat 25.06.1888 mit Michael Stern (1852-1929)." } }
            ]
        };

        // --- D3.js Visualization Code ---

        const width = window.innerWidth;
        const height = window.innerHeight;
        
        const treeLayout = d3.tree().nodeSize([150, 220]); // Increased spacing

        const svg = d3.select("#tree-container").append("svg")
            .attr("width", width)
            .attr("height", height);

        const g = svg.append("g");

        const tooltip = d3.select("#tooltip");
        const tooltipName = d3.select("#tooltip-name");
        const tooltipDetails = d3.select("#tooltip-details");

        const zoom = d3.zoom()
            .scaleExtent([0.1, 3])
            .on("zoom", (event) => {
                g.attr("transform", event.transform);
            });

        svg.call(zoom);

        let layoutSettings = {};
        let maxVisibleDepth = 2; // Default visible depth
        let flatData = []; // For easy searching

        function findMaxDepth(node) {
            let max = node.depth;
            if (node.children) {
                node.children.forEach(child => {
                    max = Math.max(max, findMaxDepth(child));
                });
            }
            return max;
        }

        function getLayoutSettings() {
            const settings = {};
            d3.selectAll('.level-layout-switch').each(function() {
                settings[this.dataset.level] = this.value;
            });
            return settings;
        }

        function createLayoutControls(maxDepth) {
            const container = d3.select("#controls-container");
            container.html(''); // Clear

            // --- Search Control ---
            const searchGroup = container.append('div').attr('class', 'control-group').attr('id', 'search-container');
            searchGroup.append('label').attr('for', 'search-input').text('Suche:');
            searchGroup.append('input')
                .attr('type', 'text')
                .attr('id', 'search-input')
                .attr('placeholder', 'Name eingeben...');
            searchGroup.append('div').attr('id', 'search-results');
            
            // --- Depth Filter Control ---
            const depthGroup = container.append('div').attr('class', 'control-group');
            depthGroup.append('label').attr('for', 'depth-switch').text('Ebenen anzeigen:');
            const depthSelect = depthGroup.append('select')
                .attr('id', 'depth-switch')
                .on('change', function() {
                    maxVisibleDepth = parseInt(this.value);
                    setTreeVisibility(root, maxVisibleDepth);
                    update(root);
                });
            
            for (let i = 1; i <= maxDepth; i++) {
                depthSelect.append('option').attr('value', i).text(i)
                    .property('selected', i === maxVisibleDepth);
            }

            // --- Per-Level Layout Controls ---
            for (let i = 0; i < maxDepth; i++) {
                const controlGroup = container.append('div').attr('class', 'control-group');
                controlGroup.append('label').attr('for', `level-switch-${i}`).text(`Layout Ebene ${i+1}:`);
                controlGroup.append('select')
                    .attr('id', `level-switch-${i}`)
                    .attr('data-level', i)
                    .attr('class', 'level-layout-switch')
                    .on('change', function() {
                        layoutSettings = getLayoutSettings();
                        update(root);
                    })
                    .selectAll('option')
                    .data(['horizontal', 'vertical'])
                    .enter()
                    .append('option')
                    .attr('value', d => d)
                    .property("selected", d => d === 'horizontal')
                    .text(d => d === 'horizontal' ? 'Horizontal' : 'Vertikal');
            }
        }

        function setTreeVisibility(node, depth) {
            if (!node.children && node._children) {
                 node.children = node._children;
            }
            
            if (node.depth >= depth) {
                if(node.children) node._children = node.children;
                node.children = null;
            } else if (node._children) {
                node.children = node._children;
                node.children.forEach(c => setTreeVisibility(c, depth));
            }
        }
        
        const tempRoot = d3.hierarchy(familyData);
        const maxDataDepth = findMaxDepth(tempRoot);
        createLayoutControls(maxDataDepth);
        layoutSettings = getLayoutSettings();

        const root = d3.hierarchy(familyData, d => d.children);
        flatData = root.descendants(); // Populate flat data for search
        root.x0 = width / 2;
        root.y0 = 0;

        root.descendants().forEach((d, i) => {
            d.id = i;
            d._children = d.children;
        });
        
        setTreeVisibility(root, maxVisibleDepth);

        function getTreeExtent(node) {
            let minX = node.x;
            let maxX = node.x;
            if (node.children) {
                node.children.forEach(child => {
                    const [childMinX, childMaxX] = getTreeExtent(child);
                    minX = Math.min(minX, childMinX);
                    maxX = Math.max(maxX, childMaxX);
                });
            }
            if (node.parent && layoutSettings[node.parent.depth] === 'vertical') {
                maxX += 100;
            }
            return [minX, maxX];
        }

        function shiftTree(node, shiftAmount) {
            node.x += shiftAmount;
            if (node.children) {
                node.children.forEach(child => shiftTree(child, shiftAmount));
            }
        }

        function update(source) {
            const duration = 500;
            
            const treeData = treeLayout(root);
            let nodes = treeData.descendants();
            let links = treeData.links();

            nodes.forEach(parentNode => {
                if (!parentNode.children || layoutSettings[parentNode.depth] !== 'vertical') {
                    return;
                }
                const verticalNodeSpacing = { indent: 30, yGap: 50 };
                let lastY = parentNode.y;
                parentNode.children.forEach(childNode => {
                    childNode.x = parentNode.x + verticalNodeSpacing.indent;
                    lastY += verticalNodeSpacing.yGap;
                    childNode.y = lastY;
                });
            });

            root.eachAfter(node => {
                if (!node.children || layoutSettings[node.depth] !== 'horizontal') {
                    return;
                }
                const horizontalGap = 40;
                for (let i = 1; i < node.children.length; i++) {
                    const leftSubtree = node.children[i - 1];
                    const rightSubtree = node.children[i];
                    
                    const leftExtent = getTreeExtent(leftSubtree);
                    const rightExtent = getTreeExtent(rightSubtree);
                    
                    const shift = (leftExtent[1] - rightExtent[0]) + horizontalGap;
                    if (shift > 0) {
                        shiftTree(rightSubtree, shift);
                    }
                }
            });

            const node = g.selectAll("g.node").data(nodes, d => d.id);

            const nodeEnter = node.enter().append("g")
                .attr("class", "node")
                .attr("transform", d => `translate(${source.x0},${source.y0})`)
                .on("click", (event, d) => click(d))
                .on("mouseover", mouseover)
                .on("mouseout", mouseout);

            nodeEnter.append("circle").attr("r", 1e-6);
            nodeEnter.append("text").text(d => d.data.name);

            const nodeUpdate = nodeEnter.merge(node);
            nodeUpdate.transition().duration(duration).attr("transform", d => `translate(${d.x},${d.y})`);
            
            nodeUpdate.select("text").transition().duration(duration)
                .attr("x", d => (!d.parent || layoutSettings[d.parent.depth] === 'horizontal') ? 0 : 15)
                .attr("y", d => (!d.parent || layoutSettings[d.parent.depth] === 'horizontal') ? 30 : 5)
                .attr("text-anchor", d => (!d.parent || layoutSettings[d.parent.depth] === 'horizontal') ? "middle" : "start");

            nodeUpdate.select("circle").attr("r", 10)
                .style("fill", d => d._children ? "#0ea5e9" : "#fff");
            
            nodeUpdate.classed("highlight", false); // Remove any previous highlight

            const nodeExit = node.exit().transition().duration(duration)
                .attr("transform", d => `translate(${source.x},${source.y})`).remove();
            nodeExit.select("circle").attr("r", 1e-6);
            nodeExit.select("text").style("fill-opacity", 1e-6);

            const link = g.selectAll("path.link").data(links, d => d.target.id);

            const linkEnter = link.enter().insert("path", "g")
                .attr("class", "link")
                .attr("d", d => {
                    const o = { x: source.x0, y: source.y0, parent: source.parent };
                    return elbow(o, o);
                });

            linkEnter.merge(link).transition().duration(duration)
                .attr("d", d => elbow(d.source, d.target));

            link.exit().transition().duration(duration)
                .attr("d", d => {
                    const o = { x: source.x, y: source.y, parent: source.parent };
                    return elbow(o, o);
                }).remove();

            nodes.forEach(d => { d.x0 = d.x; d.y0 = d.y; });
        }

        function elbow(s, d) {
            if (!d.parent) return `M${s.x},${s.y}L${d.x},${d.y}`;
            const parentLayout = layoutSettings[d.parent.depth];
            if (parentLayout === 'vertical') {
                return `M${s.x},${s.y} L${s.x},${d.y} L${d.x},${d.y}`;
            }
            return `M${s.x},${s.y}V${(s.y + d.y) / 2}H${d.x}V${d.y}`;
        }

        function click(d) {
            if (d.children) {
                d._children = d.children;
                d.children = null;
            } else {
                d.children = d._children;
            }
            update(d);
        }
        
        function mouseover(event, d) {
            tooltip.transition().duration(200).style("opacity", .95);
            let detailsHTML = '';
            const details = d.data.details;
            if (details) {
                if (details.geboren || details.gestorben) {
                    detailsHTML += `<p><strong>Lebensdaten:</strong> ${details.geboren || '?'} - ${details.gestorben || '?'}</p>`;
                }
                if (details.info) {
                    detailsHTML += `<p class="mt-2"><strong>Info:</strong> ${details.info}</p>`;
                }
            }
            tooltipName.text(d.data.name);
            tooltipDetails.html(detailsHTML || 'Keine weiteren Details verfügbar.');
            tooltip.style("left", (event.pageX + 15) + "px")
                   .style("top", (event.pageY - 28) + "px");
        }

        function mouseout(event, d) {
            tooltip.transition().duration(500).style("opacity", 0);
        }

        // --- Search Functionality ---
        function showPathAndCenter(d) {
            // Expand all ancestors to make the node visible
            let current = d;
            while(current.parent) {
                current = current.parent;
                if(current._children) {
                    current.children = current._children;
                }
            }
            update(d); // Redraw the tree with expanded nodes

            // After redraw, center on the node
            setTimeout(() => {
                const transform = d3.zoomIdentity
                    .translate(width / 2 - d.x * 0.6, height / 2 - d.y * 0.6)
                    .scale(0.6);
                
                svg.transition().duration(750).call(zoom.transform, transform);

                // Highlight the node
                d3.selectAll('.node').filter(node_d => node_d.id === d.id).classed('highlight', true);

            }, 550); // Wait for the update transition to finish
        }

        d3.select('#search-input').on('input', function(event) {
            const value = this.value.toLowerCase();
            const resultsContainer = d3.select('#search-results');
            resultsContainer.html('');

            if (value.length < 3) {
                return;
            }

            const results = flatData.filter(d => d.data.name.toLowerCase().includes(value));
            
            results.forEach(d => {
                resultsContainer.append('div')
                    .attr('class', 'search-result-item')
                    .text(d.data.name)
                    .on('click', () => {
                        showPathAndCenter(d);
                        resultsContainer.html(''); // Clear results after click
                        this.value = ''; // Clear input
                    });
            });
        });


        // --- Initial Draw ---
        update(root);
        
        const initialTransform = d3.zoomIdentity.translate(width / 2, 80).scale(0.6);
        svg.call(zoom.transform, initialTransform);

        window.addEventListener('resize', () => {
            svg.attr('width', window.innerWidth).attr('height', window.innerHeight);
        });

    </script>
</body>
</html>
