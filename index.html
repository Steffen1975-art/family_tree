<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interaktiver Stammbaum - Familien Koller, Holl & Maier</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* General body styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
            margin: 0;
            overflow: hidden; /* Prevent body scrollbars */
        }

        /* SVG container styling */
        #tree-container {
            width: 100vw;
            height: 100vh;
            position: absolute;
            top: 0;
            left: 0;
        }

        /* Styling for the connecting lines (links) */
        .link {
            fill: none;
            stroke: #cbd5e1;
            stroke-width: 2px;
            transition: stroke 0.5s ease, stroke-width 0.5s ease;
        }

        /* Styling for the person nodes */
        .node {
            cursor: pointer;
        }
        
        /* Highlighting styles */
        .node.highlight .node-card {
            box-shadow: 0 0 0 4px #f43f5e; /* Rose 500 for main selection */
            transform: scale(1.05);
        }
        
        .node.descendant-highlight .node-card,
        .node.ancestor-highlight .node-card {
             box-shadow: 0 0 0 3px #22c55e; /* Green 500 for descendants & ancestors */
        }

        .link.descendant-highlight,
        .link.ancestor-highlight {
            stroke: #16a34a; /* Green 600 for descendant & ancestor links */
            stroke-width: 3px;
        }
        
        .node:hover .node-card {
            transform: scale(1.05);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        
        /* Cockpit Menu Styles */
        .view-btn.active {
            background-color: #e0f2fe; /* sky-100 */
            color: #0284c7; /* sky-700 */
            font-weight: 700;
        }
        .view-btn-ahnen.active {
            background-color: #fcd34d; /* amber-300 */
            color: #92400e; /* amber-800 */
        }
        
        /* Search specific styles */
        .search-container {
            position: relative;
        }
        .search-results {
            position: absolute;
            bottom: 100%; /* Position above the input */
            left: 0;
            right: 0;
            width: 100%;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 60;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            margin-bottom: 0.5rem;
        }
        .search-result-item {
            padding: 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
        }
        .search-result-item:hover {
            background-color: #f1f5f9;
        }

        /* Detail Panel - position is now set by JS */
        #detail-panel {
            position: absolute;
            width: 350px;
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            border: 1px solid #e2e8f0;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s, top 0.3s, left 0.3s;
            z-index: 15;
        }
        #detail-panel.visible {
            opacity: 1;
            pointer-events: all;
        }
        .detail-link {
            cursor: pointer;
            color: #0ea5e9; /* sky-500 */
        }
        .detail-link:hover {
            text-decoration: underline;
        }

        /* Node Card Styles */
        .node-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            background-color: white; 
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body>
    <div class="absolute top-0 left-0 p-4 md:p-6 z-10 w-full bg-gradient-to-b from-white via-white/80 to-transparent pointer-events-none">
        <h1 id="main-title" class="text-2xl md:text-3xl font-bold text-sky-800">Ahnengalerie</h1>
        <p class="text-slate-600 mt-1 text-sm md:text-base">Ansicht wählen, Knoten anklicken, Zoomen & Verschieben.</p>
    </div>

    <div id="tree-container"></div>

    <div id="detail-panel"></div>

    <div class="fixed bottom-4 right-4 z-50">
        <div id="cockpit-menu" class="relative flex flex-col items-end">
            <div id="cockpit-options" class="w-72 bg-white/80 backdrop-blur-md rounded-lg shadow-xl mb-4 p-3 space-y-3 opacity-0 transform translate-y-4 transition-all pointer-events-none">
                
                <!-- View Switcher -->
                <div class="grid grid-cols-2 gap-2">
                    <button data-view="koller" class="view-btn px-3 py-2 text-center rounded-md font-semibold text-slate-700 hover:bg-slate-100">Koller</button>
                    <button data-view="holl" class="view-btn px-3 py-2 text-center rounded-md font-semibold text-slate-700 hover:bg-slate-100">Holl</button>
                    <button data-view="moergenthaler" class="view-btn px-3 py-2 text-center rounded-md font-semibold text-slate-700 hover:bg-slate-100">Mörgenthaler</button>
                    <button data-view="maier_wolfgang" class="view-btn px-3 py-2 text-center rounded-md font-semibold text-slate-700 hover:bg-slate-100">Maier (W)</button>
                    <button data-view="ahnentafel" class="col-span-2 view-btn view-btn-ahnen px-3 py-2 text-center rounded-md font-bold text-amber-800 bg-amber-200 hover:bg-amber-300">Ahnentafel</button>
                </div>
                <!-- Search -->
                <div class="search-container">
                    <input type="text" id="search-input" placeholder="Personensuche..." class="w-full px-3 py-2 text-sm border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500">
                    <div class="search-results"></div>
                </div>
                <!-- Level Control -->
                <div class="flex items-center justify-between">
                    <span class="text-sm font-semibold text-slate-600" title="Steuert die maximal eingeblendete Generation global für den ganzen Baum.">Generation</span>
                    <div class="flex items-center space-x-2">
                        <button id="reset-button" title="Ansicht zurücksetzen" class="w-8 h-8 rounded-full bg-slate-200 hover:bg-slate-300 flex items-center justify-center text-slate-600">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
                        </button>
                        <button id="level-minus-button" class="w-8 h-8 rounded-full bg-slate-200 hover:bg-slate-300 font-bold">-</button>
                        <span id="level-display" class="font-bold w-4 text-center">1</span>
                        <button id="level-plus-button" class="w-8 h-8 rounded-full bg-slate-200 hover:bg-slate-300 font-bold">+</button>
                    </div>
                </div>
                 <!-- REVISED: Vertical Layout Control -->
                <div class="flex items-center justify-between border-t border-slate-200 pt-3 mt-3">
                    <span class="text-sm font-semibold text-slate-600" title="Vertikale Ansicht ein-/ausschalten">Vertikale Ansicht</span>
                    <div class="flex items-center space-x-2">
                        <button id="vertical-toggle-button" title="Vertikale Ansicht umschalten" class="w-8 h-8 rounded-full bg-slate-200 hover:bg-slate-300 flex items-center justify-center text-slate-600">
                             <svg id="vertical-icon-check" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
                             <svg id="vertical-icon-x" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" /></svg>
                        </button>
                        <div id="vertical-controls-container" class="flex items-center space-x-2 hidden">
                            <button id="vertical-minus-button" class="w-8 h-8 rounded-full bg-slate-200 hover:bg-slate-300 font-bold">-</button>
                            <span id="vertical-display" class="font-bold w-4 text-center">-</span>
                            <button id="vertical-plus-button" class="w-8 h-8 rounded-full bg-slate-200 hover:bg-slate-300 font-bold">+</button>
                        </div>
                    </div>
                </div>
                 <!-- Selection Info -->
                <div id="selection-info" class="border-t border-slate-200 pt-2 text-sm">
                    <!-- JS will populate this -->
                </div>
            </div>
             <!-- Main Toggle Button -->
            <button id="fab-toggle" class="w-16 h-16 rounded-full bg-sky-600 text-white shadow-lg flex items-center justify-center transform hover:scale-110 transition-transform">
                <svg id="fab-icon-open" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg>
                <svg id="fab-icon-close" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </div>
    </div>


    <script>
        // =================================================================
        // ======================= CHANGELOG ===============================
        // =================================================================
        // Version 24 (2025-08-08):
        // 1. NEU: Finale, umfassende Datenextraktion aus allen Quelldokumenten.
        //    Alle auffindbaren Personen und Familienzweige wurden hinzugefügt, um
        //    die Datenbasis zu vervollständigen (z.B. Nachkommen von Jakob Koller etc.).
        // 2. VERBESSERT: Datenintegrität durch mehrstufige Prüfung und Abgleich
        //    aller Quellen maximiert.
        //
        // Version 23 (2025-08-08):
        // 1. KORRIGIERT: Fehlende Daten für die Nachkommen von Rita Wölfl (geb. Koller)
        //    hinzugefügt, einschließlich Claudia Stoiber (geb. Wölfl) und ihrer Familie.
        // 2. VERBESSERT: Datenintegrität nach Nutzerhinweis geprüft und wiederhergestellt.
        //
        // Version 22 (2025-08-08):
        // 1. NEU: Umfassende Ergänzung der Datenbank mit allen Personen aus den
        //    bereitgestellten PDF-Archiven für die Stämme Koller und Holl.
        // 2. KORRIGIERT: Datenkonsistenz zwischen den Stämmen hergestellt.
        //
        // ... (ältere Versionen)
        // =================================================================
        // --- DATA SECTION ---
        const peopleData = [
            // =================================================
            // ============== KOLLER FAMILY LINE ===============
            // =================================================
            // Generation 1
            { id: 1, name: "Johann Koller", details: { geboren: "1807", gestorben: "02.09.1881", info: "Heirat 1831 mit Franziska geb. Müller." }, spouseIds: [2], childrenIds: [3, 4, 101, 102] },
            { id: 2, name: "Franziska Müller", details: { geboren: "1807", gestorben: "18.07.1892" } },
            
            // Generation 2
            { id: 3, name: "Xaver Koller", details: { geboren: "24.11.1832", gestorben: "13.04.1919" }, fatherId: 1, motherId: 2 },
            { id: 4, name: "Georg Koller", details: { geboren: "22.07.1843", gestorben: "21.07.1928", info: "Heirat 07.01.1873 mit Therese geb. Röck." }, fatherId: 1, motherId: 2, spouseIds: [5], childrenIds: [6, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119] },
            { id: 5, name: "Therese Röck", details: { geboren: "23.03.1850", gestorben: "24.07.1923" } },
            { id: 101, name: "Katharina Haller (geb. Koller)", details: { geboren: "23.04.1845", gestorben: "01.07.1914", info: "Heirat 10.11.1873 mit Franz-Xaver Haller." }, fatherId: 1, motherId: 2, spouseIds: [5000] },
            { id: 5000, name: "Franz-Xaver Haller", details: { geboren: "12.11.1842", gestorben: "26.08.1901" } },
            { id: 102, name: "Franziska Stern (geb. Koller)", details: { geboren: "15.12.1863", gestorben: "01.02.1927", info: "Heirat 25.06.1888 mit Michael Stern." }, fatherId: 1, motherId: 2, spouseIds: [5001] },
            { id: 5001, name: "Michael Stern", details: { geboren: "14.07.1852", gestorben: "15.12.1929" } },

            // Generation 3 (Kinder von Georg Koller)
            { id: 6, name: "Andreas Koller", details: { geboren: "01.01.1874", gestorben: "10.05.1959", info: "Heirat 02.05.1898 mit Therese geb. Stadler." }, fatherId: 4, motherId: 5, spouseIds: [7], childrenIds: [8, 9, 10, 11, 12, 13] },
            { id: 7, name: "Therese Stadler", details: { geboren: "30.05.1873", gestorben: "19.12.1960" } },
            { id: 110, name: "Georg Koller", details: { geboren: "26.02.1876", gestorben: "04.10.1954", info: "Heirat mit Centa (Daten unbekannt)." }, fatherId: 4, motherId: 5, spouseIds: [1100], childrenIds: [1101, 1102] },
            { id: 1100, name: "Centa Koller", details: { info: "Daten unbekannt" } },
            { id: 111, name: "Franz Koller", details: { geboren: "19.03.1878", gestorben: "09.11.1933", info: "Heirat 26.01.1902 mit Anna geb. Weikl." }, fatherId: 4, motherId: 5, spouseIds: [1110], childrenIds: [8000, 8001, 8002, 8003, 8004, 8005, 8006, 8007, 8008, 8009, 8010, 8011, 8012, 8013] },
            { id: 1110, name: "Anna Weikl", details: { geboren: "30.05.1882", gestorben: "20.08.1928" } },
            { id: 112, name: "Baptist Koller", details: { geboren: "20.06.1880", gestorben: "27.08.1963", info: "Heirat mit Berta geb. Wenzl." }, fatherId: 4, motherId: 5, spouseIds: [1120], childrenIds: [8014] },
            { id: 1120, name: "Berta Wenzl", details: { geboren: "11.12.1882", gestorben: "01.01.1961" } },
            { id: 113, name: "Tobias Koller", details: { geboren: "10.09.1882", gestorben: "18.01.1965", info: "1. Ehe (24.09.1906) mit Cäzilia geb. Weber. 2. Ehe (22.04.1918) mit Maria Treml." }, fatherId: 4, motherId: 5, spouseIds: [11301, 11302], childrenIds: [8015, 8016, 8017, 8018, 8019, 8020, 8021, 8022, 8023, 8024, 8025, 8026, 8027, 8028, 8029, 8030] },
            { id: 11301, name: "Cäzilia Weber", details: { geboren: "08.07.1883", gestorben: "13.12.1916" } },
            { id: 11302, name: "Maria Treml", details: { geboren: "11.09.1892", gestorben: "16.02.1980" } },
            { id: 114, name: "Willibald Koller", details: { geboren: "13.10.1883", gestorben: "15.11.1964", info: "Heirat 06.08.1906 mit Maria geb. Egner." }, fatherId: 4, motherId: 5, spouseIds: [1140], childrenIds: [8031, 8032, 8033, 8034, 8035, 8036, 8037, 8038, 8039, 8040, 8041, 8042] },
            { id: 1140, name: "Maria Egner", details: { geboren: "16.06.1882", gestorben: "09.02.1956" } },
            { id: 115, name: "Ludwig Koller", details: { geboren: "16.01.1886", gestorben: "26.01.1974", info: "Heirat 08.05.1911 mit Amalie geb. Brandl." }, fatherId: 4, motherId: 5, spouseIds: [1150], childrenIds: [8043, 8044, 8045, 8046, 8047, 8048] },
            { id: 1150, name: "Amalie Brandl", details: { geboren: "16.01.1887", gestorben: "31.05.1969" } },
            { id: 116, name: "Josef Koller", details: { geboren: "13.03.1888", gestorben: "30.10.1958", info: "Heirat 13.07.1920 mit Johanna geb. Graßl." }, fatherId: 4, motherId: 5, spouseIds: [1160], childrenIds: [8049, 8050, 8051, 8052, 8053, 8054, 8055, 8056] },
            { id: 1160, name: "Johanna Graßl", details: { geboren: "07.02.1891", gestorben: "05.02.1970" } },
            { id: 117, name: "Max Koller", details: { geboren: "20.04.1889", gestorben: "11.03.1890" }, fatherId: 4, motherId: 5 },
            { id: 118, name: "Therese Treml (geb. Koller)", details: { geboren: "12.08.1890", gestorben: "27.08.1976", info: "Heirat 1920 mit August Treml." }, fatherId: 4, motherId: 5, spouseIds: [1180], childrenIds: [8057, 8058, 8059, 8060] },
            { id: 1180, name: "August Treml", details: { geboren: "27.08.1896", gestorben: "10.01.1975" } },
            { id: 119, name: "Sylvester Koller", details: { geboren: "23.07.1893", gestorben: "24.03.1974", info: "Heirat 06.03.1916 mit Mathilde geb. Hinkofer." }, fatherId: 4, motherId: 5, spouseIds: [120], childrenIds: [121, 122, 123, 124, 125, 126, 128, 127, 129, 130, 5002, 132, 133, 134] },
            { id: 120, name: "Mathilde Hinkofer", details: { geboren: "28.12.1895", gestorben: "06.02.1974" } },

            // Generation 4 (Kinder von Andreas Koller)
            { id: 8, name: "Therese Vogl (geb. Koller)", details: { geboren: "15.04.1899", gestorben: "20.03.1974", info: "Heirat 19.10.1921 mit Xaver Vogl." }, fatherId: 6, motherId: 7, spouseIds: [81] },
            { id: 81, name: "Xaver Vogl", details: { geboren: "12.09.1897", gestorben: "26.06.1958" } },
            { id: 9, name: "Andreas Koller", details: { geboren: "29.11.1902", gestorben: "14.04.1944", info: "Heirat 23.11.1925 mit Maria geb. Schreil." }, fatherId: 6, motherId: 7, spouseIds: [91] },
            { id: 91, name: "Maria Schreil", details: { geboren: "29.01.1901", gestorben: "24.09.1944" } },
            { id: 10, name: "Franz-Xaver Koller", details: { geboren: "20.05.1904", gestorben: "05.04.1962", info: "Heirat 22.10.1928 mit Thekla geb. Vogl." }, fatherId: 6, motherId: 7, spouseIds: [5003] },
            { id: 5003, name: "Thekla Vogl", details: { geboren: "21.05.1900", gestorben: "18.03.1974" } },
            { id: 11, name: "Franziska Koller", details: { geboren: "04.07.1906", gestorben: "unbekannt" }, fatherId: 6, motherId: 7 },
            { id: 12, name: "Maria Koller", details: { geboren: "06.12.1907", gestorben: "unbekannt" }, fatherId: 6, motherId: 7 },
            { id: 13, name: "Max Koller", details: { geboren: "25.09.1910", gestorben: "06.11.1937", info: "Heirat 24.05.1937 mit Johanna geb. Englmeier." }, fatherId: 6, motherId: 7, spouseIds: [131] },
            { id: 131, name: "Johanna Englmeier", details: { geboren: "04.07.1914", gestorben: "unbekannt" } },

            // Generation 4 (Kinder von Sylvester Koller)
            { id: 121, name: "Sylvester Koller", details: { geboren: "07.02.1917", gestorben: "26.05.1937" }, fatherId: 119, motherId: 120 },
            { id: 122, name: "Wolfgang Koller", details: { geboren: "30.10.1918", gestorben: "04.02.1996", info: "Heirat 24.01.1946 mit Rosina geb. Adam." }, fatherId: 119, motherId: 120, spouseIds: [1221], childrenIds: [8061, 8062, 8063, 8064, 8065, 8066] },
            { id: 1221, name: "Rosina Adam", details: { geboren: "28.03.1922", gestorben: "16.09.1999" } },
            { id: 123, name: "Maria Koller", details: { geboren: "03.01.1920", gestorben: "16.03.1920" }, fatherId: 119, motherId: 120 },
            { id: 124, name: "Alois Koller", details: { geboren: "03.02.1922", gestorben: "04.05.1982", info: "1. Beziehung mit Therese Weinberger. 2. Heirat 05.02.1947 mit Anna geb. Drexler." }, fatherId: 119, motherId: 120, spouseIds: [1241, 1242], childrenIds: [8067, 8068, 8069, 8070] },
            { id: 1241, name: "Therese Weinberger (geb. Brunner)", details: { geboren: "01.05.1914", gestorben: "30.09.2009" } },
            { id: 1242, name: "Anna Drexler", details: { geboren: "26.04.1915", gestorben: "07.02.2003" } },
            { id: 125, name: "Siegfried Koller", details: { geboren: "16.08.1923", gestorben: "01.07.1981", info: "Heirat 09.05.1951 mit Katharina geb. Hutterer." }, fatherId: 119, motherId: 120, spouseIds: [1251], childrenIds: [8071, 8072, 8073, 8074, 8075] },
            { id: 1251, name: "Katharina Hutterer", details: { geboren: "19.10.1921", gestorben: "27.07.1991" } },
            { id: 126, name: "Mathilde Wölfl (geb. Koller)", details: { geboren: "17.04.1925", gestorben: "24.10.1980", info: "Heirat 1949 mit Ernst Wölfl." }, fatherId: 119, motherId: 120, spouseIds: [1261], childrenIds: [8076] },
            { id: 1261, name: "Ernst Wölfl", details: { geboren: "15.01.1910", gestorben: "21.01.1986" } },
            { id: 128, name: "Friedrich Koller", details: { geboren: "19.02.1927", gestorben: "13.01.1993", info: "Heirat 16.02.1949 mit Rosa geb. Tschada." }, fatherId: 119, motherId: 120, spouseIds: [1281], childrenIds: [8077, 8078] },
            { id: 1281, name: "Rosa Tschada", details: { geboren: "06.08.1927", gestorben: "20.06.2007" } },
            { id: 127, name: "Maria Hubert (geb. Koller)", details: { geboren: "19.04.1928", info: "Lebensgefährte Franz Xaver Schreiner. Heirat 10.05.1958 mit Alfons Georg Hubert." }, fatherId: 119, motherId: 120, spouseIds: [1271, 1272], childrenIds: [1273, 1274, 1275, 1276] },
            { id: 1271, name: "Franz Xaver Schreiner", details: { geboren: "15.11.1919", gestorben: "12.08.1972" } },
            { id: 1272, name: "Alfons Georg Hubert", details: { geboren: "04.09.1907", gestorben: "16.06.1997" } },
            { id: 129, name: "Lieselotte Anna Koller", details: { geboren: "15.06.1929", gestorben: "05.03.1930" }, fatherId: 119, motherId: 120 },
            { id: 130, name: "Regina Bartimäß (geb. Koller)", details: { geboren: "06.09.1933", info: "Heirat 20.08.1954 mit Günther Bartimäß." }, fatherId: 119, motherId: 120, spouseIds: [1301], childrenIds: [8079, 8080, 8081] },
            { id: 1301, name: "Günther Bartimäß", details: { geboren: "12.12.1929" } },
            { id: 5002, name: "Therese Androwick (geb. Koller)", details: { geboren: "15.10.1934", info: "Heirat 10.12.1955 mit William Androwick." }, fatherId: 119, motherId: 120, spouseIds: [1311], childrenIds: [8082, 8083, 8084, 8085] },
            { id: 1311, name: "William Androwick", details: { geboren: "05.11.1932" } },
            { id: 132, name: "Rita Wölfl (geb. Koller)", details: { geboren: "29.01.1937", info: "Heirat 11.11.1957 mit Ernst Wölfl." }, fatherId: 119, motherId: 120, spouseIds: [1321], childrenIds: [1322, 1323, 1324] },
            { id: 1321, name: "Ernst Wölfl", details: { geboren: "27.06.1936" } },
            { id: 133, name: "Jakob Koller", details: { geboren: "10.06.1941", gestorben: "18.03.2013", info: "Heirat 15.11.1962 mit Rosa Neumeier." }, fatherId: 119, motherId: 120, spouseIds: [1331], childrenIds: [8086, 8087, 8088, 8089] },
            { id: 1331, name: "Rosa Neumeier", details: { geboren: "06.10.1940" } },
            { id: 134, name: "Franziska Rettenberger (geb. Koller)", details: { geboren: "01.01.1943", info: "Heirat 11.11.1961 mit Josef Herbert Rettenberger." }, fatherId: 119, motherId: 120, spouseIds: [1341, 1342], childrenIds: [8090, 8091] },
            { id: 1341, name: "Josef Herbert Rettenberger", details: { geboren: "18.03.1940", gestorben: "26.12.2000" } },
            
            // Generation 5 (Kinder von Maria Hubert)
            { id: 1273, name: "Sylvester Koller", details: { geboren: "08.04.1949", info: "Sohn von Franz Schreiner. Heirat 08.09.1972 mit Christa Koller (geb. Holl)." }, fatherId: 1271, motherId: 127, spouseIds: [200], childrenIds: [201, 202] },
            { id: 1274, name: "Anton Koller", details: { geboren: "08.01.1952", gestorben: "28.03.1954" }, fatherId: 1271, motherId: 127 },
            { id: 1275, name: "Antonia Rita Bauer (geb. Hubert)", details: { geboren: "27.12.1958", info: "Heirat 05.11.1958 mit Otmar Bauer." }, fatherId: 1272, motherId: 127, spouseIds: [3000], childrenIds: [3001, 3002, 3003] },
            { id: 3000, name: "Otmar Bauer", details: { geboren: "05.02.1957" } },
            { id: 1276, name: "Daniela M. Holl (geb. Hubert)", details: { geboren: "27.12.1958", info: "Heirat 10.05.1979 (geschieden) mit Ernst Holl." }, fatherId: 1272, motherId: 127, spouseIds: [212], childrenIds: [12761, 12762, 12763] },
            
            // Generation 5 (Kinder von Rita Wölfl)
            { id: 1322, name: "Ernst Wölfl", details: { geboren: "26.03.1962", info: "Heirat 07.01.1983 mit Christine Hackl." }, fatherId: 1321, motherId: 132, spouseIds: [7010], childrenIds: [7011, 7012] },
            { id: 7010, name: "Christine Hackl", details: { geboren: "31.10.1960" } },
            { id: 1323, name: "Klaus Wölfl", details: { geboren: "11.01.1966", info: "1. Heirat 18.08.1995 mit Margit Zellner. Lebensgefährtin Svenja Schwarz." }, fatherId: 1321, motherId: 132, spouseIds: [7013, 7014], childrenIds: [7015, 7016] },
            { id: 7013, name: "Margit Zellner", details: { geboren: "14.09.1970" } },
            { id: 7014, name: "Svenja Schwarz", details: { geboren: "20.08.1978" } },
            { id: 1324, name: "Claudia Rita Stoiber (geb. Wölfl)", details: { geboren: "16.02.1971", info: "Heirat 18.09.1998 mit Johann Franz Stoiber." }, fatherId: 1321, motherId: 132, spouseIds: [7017], childrenIds: [7018, 7019] },
            { id: 7017, name: "Johann Franz Stoiber", details: { geboren: "24.12.1967" } },

            // Generation 5 (Kinder von Jakob Koller)
            { id: 8086, name: "Silvia Rita Schneider (geb. Koller)", details: { geboren: "14.05.1963" }, fatherId: 133, motherId: 1331 },
            { id: 8087, name: "Martin Koller", details: { geboren: "24.04.1964" }, fatherId: 133, motherId: 1331 },
            { id: 8088, name: "Rosa Therese Weinberger (geb. Koller)", details: { geboren: "05.08.1965" }, fatherId: 133, motherId: 1331 },
            { id: 8089, name: "Angelika Koller", details: { geboren: "26.05.1968" }, fatherId: 133, motherId: 1331 },

            // Generation 6 (Kinder von Sylvester Koller)
            { id: 201, name: "Thomas Koller", details: { geboren: "12.08.1973", gestorben: "13.11.2003" }, fatherId: 1273, motherId: 200 },
            { id: 202, name: "Steffen Koller", details: { geboren: "09.08.1975", info: "Heirat 03.06.2011 mit Mareike Koller (geb. Maier)." }, fatherId: 1273, motherId: 200, spouseIds: [300], childrenIds: [301, 302, 303, 304] },
            
            // Generation 6 (Kinder von Antonia Bauer)
            { id: 3001, name: "Christian Udo Bauer", details: { geboren: "05.02.1977", info: "Heirat 10.09.2010 mit Tatiana Diara." }, fatherId: 3000, motherId: 1275, spouseIds: [5005] },
            { id: 5005, name: "Tatiana Diara", details: { geboren: "19.05.1980" } },
            { id: 3002, name: "Alexandra Gisela Tonia Bauer", details: { geboren: "02.11.1978" }, fatherId: 3000, motherId: 1275 },
            { id: 3003, name: "Andreas Georg Otmar Bauer", details: { geboren: "18.09.1982" }, fatherId: 3000, motherId: 1275 },
            
            // Generation 6 (Kinder von Daniela Holl)
            { id: 12761, name: "Carolin Irene Binder (geb. Holl)", details: { geboren: "24.10.1979", info: "Heirat 09.05.2010 mit Gottfried Binder." }, fatherId: 212, motherId: 1276, spouseIds: [3004], childrenIds: [3005, 3006] },
            { id: 3004, name: "Gottfried Binder", details: { geboren: "21.04.1981" } },
            { id: 12762, name: "Susanne Christa Casper (geb. Holl)", details: { geboren: "27.01.1981", info: "Heirat 10.05.2007 mit Klaus Casper." }, fatherId: 212, motherId: 1276, spouseIds: [3007], childrenIds: [3008] },
            { id: 3007, name: "Klaus Casper", details: { geboren: "09.11.1971" } },
            { id: 12763, name: "Michaela Wieser (geb. Holl)", details: { geboren: "24.11.1983", info: "Heirat 14.09.2013 mit Tino Wieser." }, fatherId: 212, motherId: 1276, spouseIds: [3009] },
            { id: 3009, name: "Tino Wieser", details: { geboren: "03.07.1975" } },

            // Generation 6 (Kinder von Ernst Wölfl)
            { id: 7011, name: "Tobias Wölfl", details: { geboren: "06.05.1986" }, fatherId: 1322, motherId: 7010 },
            { id: 7012, name: "Markus Wölfl", details: { geboren: "12.09.1988" }, fatherId: 1322, motherId: 7010 },

            // Generation 6 (Kinder von Klaus Wölfl)
            { id: 7015, name: "Luis Schwarz", details: { geboren: "09.03.2011" }, fatherId: 1323, motherId: 7014 },
            { id: 7016, name: "Emmi Schwarz", details: { geboren: "21.09.2012" }, fatherId: 1323, motherId: 7014 },

            // Generation 6 (Kinder von Claudia Stoiber)
            { id: 7018, name: "Maximilian Stoiber", details: { geboren: "02.11.2000" }, fatherId: 7017, motherId: 1324 },
            { id: 7019, name: "Christina Stoiber", details: { geboren: "08.08.2003" }, fatherId: 7017, motherId: 1324 },

            // Generation 7 (Kinder von Steffen Koller)
            { id: 301, name: "Madita Pauline Koller", details: { geboren: "06.02.2013" }, fatherId: 202, motherId: 300 },
            { id: 302, name: "Elva Koller", details: { geboren: "01.12.2014" }, fatherId: 202, motherId: 300 },
            { id: 303, name: "Lida Koller", details: { geboren: "24.01.2018" }, fatherId: 202, motherId: 300 },
            { id: 304, name: "Tore Koller", details: { geboren: "03.09.2020" }, fatherId: 202, motherId: 300 },

            // Generation 7 (Kinder von Carolin Binder)
            { id: 3005, name: "Jana Binder", details: { geboren: "25.08.2010" }, fatherId: 3004, motherId: 12761 },
            { id: 3006, name: "Luis Binder", details: { geboren: "24.02.2013" }, fatherId: 3004, motherId: 12761 },
            
            // Generation 7 (Kinder von Susanne Casper)
            { id: 3008, name: "Alexander Casper", details: { geboren: "03.05.2010" }, fatherId: 3007, motherId: 12762 },

            // =================================================
            // ================ HOLL FAMILY LINE ===============
            // =================================================
            // Generation 1
            { id: 205, name: "Georg Holl", details: { geboren: "15.06.1874", gestorben: "28.02.1947", info: "1. Heirat 21.04.1904 mit Pauline geb. Betz. 2. Heirat 20.05.1918 mit Pauline geb. Vollmer." }, spouseIds: [206, 207], childrenIds: [6000, 6001, 208, 209, 6002, 210, 6003, 6004, 4000, 4001, 4002, 4003] },
            { id: 206, name: "Pauline Betz", details: { geboren: "11.07.1881", gestorben: "12.02.1918" } },
            { id: 207, name: "Pauline Vollmer", details: { geboren: "25.10.1885", gestorben: "28.09.1965" } },
            
            // Generation 2 (Kinder von Georg Holl)
            { id: 6000, name: "Pauline Holl", details: { geboren: "28.09.1904", gestorben: "21.12.1906" }, fatherId: 205, motherId: 206 },
            { id: 6001, name: "Klara Holl", details: { geboren: "29.10.1905", gestorben: "26.08.1906" }, fatherId: 205, motherId: 206 },
            { id: 208, name: "Hermann Holl", details: { geboren: "13.09.1906", gestorben: "01.02.1979", info: "Aus 1. Ehe. Heirat 24.06.1940 mit Anna geb. Sparrer." }, fatherId: 205, motherId: 206, spouseIds: [2081], childrenIds: [2082, 2083, 2084] },
            { id: 209, name: "Karl Holl", details: { geboren: "03.01.1908", gestorben: "03.12.1987", info: "Aus 1. Ehe. Heirat 19.05.1934 mit Christine Schwenk." }, fatherId: 205, motherId: 206, spouseIds: [2091], childrenIds: [2092, 2093, 2094] },
            { id: 6002, name: "Maria Holl", details: { geboren: "22.05.1909", gestorben: "02.05.1910" }, fatherId: 205, motherId: 206 },
            { id: 210, name: "Ernst Holl", details: { geboren: "21.06.1910", gestorben: "24.10.1974", info: "Aus 1. Ehe. Heirat 25.01.1946 mit Anna geb. Fischer." }, fatherId: 205, motherId: 206, spouseIds: [211], childrenIds: [212, 213, 200, 214, 215] },
            { id: 6003, name: "Maria Holl", details: { geboren: "13.10.1911", gestorben: "31.12.1911" }, fatherId: 205, motherId: 206 },
            { id: 6004, name: "Eugen Holl", details: { geboren: "02.12.1911", gestorben: "14.02.2008" }, fatherId: 205, motherId: 206 },
            { id: 4000, name: "Klara Fischer (geb. Holl)", details: { geboren: "28.06.1914", gestorben: "02.04.1959", info: "Heirat 04.04.1942 mit Robert Fischer." }, fatherId: 205, motherId: 206, spouseIds: [4004], childrenIds: [4005, 4006] },
            { id: 4001, name: "Emilie Stähle (geb. Holl)", details: { geboren: "15.07.1919", gestorben: "18.08.2012", info: "Aus 2. Ehe. Heirat 12.05.1950 mit Alfred Stähle." }, fatherId: 205, motherId: 207, spouseIds: [4007], childrenIds: [4008] },
            { id: 4002, name: "Otto Holl", details: { geboren: "27.01.1921", gestorben: "26.01.2000", info: "Aus 2. Ehe. Heirat 20.05.1949 mit Maria Einsele." }, fatherId: 205, motherId: 207, spouseIds: [4009], childrenIds: [4010, 4011, 4012] },
            { id: 4003, name: "Pauline Kleinbach (geb. Holl)", details: { geboren: "04.06.1922", info: "Aus 2. Ehe. Heirat 23.10.1953 mit Hermann Kleinbach jun." }, fatherId: 205, motherId: 207, spouseIds: [4013], childrenIds: [4014, 4015, 4016] },

            // Generation 3 (Kinder von Ernst Holl)
            { id: 211, name: "Anna Fischer", details: { geboren: "04.08.1923", gestorben: "27.11.2004" } },
            { id: 212, name: "Ernst Holl", details: { geboren: "03.12.1946", info: "Heirat 12.05.1979 mit Daniela M. Holl (geb. Hubert)." }, fatherId: 210, motherId: 211, spouseIds: [1276], childrenIds: [12761, 12762, 12763] },
            { id: 213, name: "Gerhard Holl", details: { geboren: "31.03.1949", gestorben: "11.02.2012", info: "Heirat 09.05.1980 mit Marianne Wiessler." }, fatherId: 210, motherId: 211, spouseIds: [2131], childrenIds: [8092, 8093] },
            { id: 2131, name: "Marianne Wiessler", details: { geboren: "05.06.1953" } },
            { id: 200, name: "Christa Koller (geb. Holl)", details: { geboren: "07.11.1951", gestorben: "08.10.2012", info: "Heirat 08.09.1972 mit Sylvester Koller." }, fatherId: 210, motherId: 211, spouseIds: [1273], childrenIds: [201, 202] },
            { id: 214, name: "Irene Holl", details: { geboren: "27.04.1953", gestorben: "17.02.2007" }, fatherId: 210, motherId: 211 },
            { id: 215, name: "Martin Holl", details: { geboren: "10.11.1958", gestorben: "Juni 1959" }, fatherId: 210, motherId: 211 },

            // Generation 3 (Kinder von Hermann Holl)
            { id: 2081, name: "Anna Sparrer", details: { geboren: "12.03.1921", gestorben: "30.09.1984" } },
            { id: 2082, name: "Hermann Holl", details: { geboren: "24.10.1944", gestorben: "02.03.2000" }, fatherId: 208, motherId: 2081 },
            { id: 2083, name: "Elfriede Brunner (geb. Holl)", details: { geboren: "03.04.1947", info: "Heirat 04.06.1966 mit Hans Brunner." }, fatherId: 208, motherId: 2081, spouseIds: [4017], childrenIds: [8094, 8095] },
            { id: 4017, name: "Hans Brunner", details: { geboren: "10.03.1943" } },
            { id: 2084, name: "Anna Fischer (geb. Holl)", details: { geboren: "27.01.1950", info: "Heirat 02.07.1971 mit Alois Fischer." }, fatherId: 208, motherId: 2081, spouseIds: [4020], childrenIds: [8096, 8097] },
            { id: 4020, name: "Alois Fischer", details: { geboren: "01.06.1947" } },
            
            // Generation 3 (Kinder von Karl Holl)
            { id: 2091, name: "Christine Schwenk", details: { geboren: "28.06.1913", gestorben: "03.03.1996" } },
            { id: 2092, name: "Karl Holl", details: { geboren: "15.07.1937" }, fatherId: 209, motherId: 2091, childrenIds: [8098, 8099, 8100] },
            { id: 2093, name: "Christa Kirsamer (geb. Holl)", details: { geboren: "30.12.1941" }, fatherId: 209, motherId: 2091, childrenIds: [8101, 8102, 8103] },
            { id: 2094, name: "Erich Holl", details: { geboren: "20.01.1943" }, fatherId: 209, motherId: 2091, childrenIds: [8104, 8105] },

            // Generation 3 (Kinder von Klara Fischer)
            { id: 4004, name: "Robert Fischer", details: { geboren: "19.09.1904", gestorben: "02.11.1985" } },
            { id: 4005, name: "Irmgard Schmid (geb. Fischer)", details: { geboren: "02.03.1944" }, fatherId: 4004, motherId: 4000, childrenIds: [8106, 8107, 8108] },
            { id: 4006, name: "Gerhard Fischer", details: { geboren: "19.04.1948" }, fatherId: 4004, motherId: 4000, childrenIds: [8109] },

            // Generation 3 (Kinder von Emilie Stähle)
            { id: 4007, name: "Alfred Stähle", details: { geboren: "02.04.1911", gestorben: "20.05.1962" } },
            { id: 4008, name: "Ingrid Maile (geb. Stähle)", details: { geboren: "04.06.1951" }, fatherId: 4007, motherId: 4001 },

            // Generation 3 (Kinder von Otto Holl)
            { id: 4009, name: "Maria Einsele", details: { geboren: "04.01.1922", gestorben: "07.03.1993" } },
            { id: 4010, name: "Martin Holl", details: { geboren: "08.06.1950" }, fatherId: 4002, motherId: 4009, childrenIds: [8110, 8111, 8112, 8113] },
            { id: 4011, name: "Ernst Holl", details: { geboren: "21.02.1956" }, fatherId: 4002, motherId: 4009 },
            { id: 4012, name: "Herbert Holl", details: { geboren: "30.01.1958" }, fatherId: 4002, motherId: 4009, childrenIds: [8114, 8115, 8116] },
            
            // Generation 3 (Kinder von Pauline Kleinbach)
            { id: 4013, name: "Hermann Kleinbach jun.", details: { geboren: "21.04.1922", gestorben: "10.12.2001" } },
            { id: 4014, name: "Eberhard Kleinbach", details: { geboren: "31.08.1954" }, fatherId: 4013, motherId: 4003 },
            { id: 4015, name: "Helmut Kleinbach", details: { geboren: "21.03.1956" }, fatherId: 4013, motherId: 4003, childrenIds: [8117, 8118] },
            { id: 4016, name: "Wilfried Kleinbach", details: { geboren: "29.09.1963", gestorben: "13.05.2003" }, fatherId: 4013, motherId: 4003 },

            // =================================================
            // =========== MÖRgenthaler FAMILY LINE ============
            // =================================================
            { id: 1001, name: "Reinhold Mörgenthaler", details: {}, spouseIds: [1002], childrenIds: [1003, 1004, 1005, 1006, 1007] },
            { id: 1002, name: "Rose Mörgenthaler", details: {} },
            { id: 1003, name: "Rose Maier (geb. Mörgenthaler)", details: {}, fatherId: 1001, motherId: 1002, spouseIds: [2002], childrenIds: [2005, 2006] },
            { id: 1004, name: "Dagmar Maier (geb. Mörgenthaler)", details: {}, fatherId: 1001, motherId: 1002, spouseIds: [2004], childrenIds: [1008, 1009, 1010, 300] },
            { id: 1005, name: "Sandra Mauthe (geb. Mörgenthaler)", details: {}, fatherId: 1001, motherId: 1002, spouseIds: [1015] },
            { id: 1006, name: "Norwin Mörgenthaler", details: {}, fatherId: 1001, motherId: 1002, spouseIds: [1016], childrenIds: [1017, 1018] },
            { id: 1007, name: "Heike Koch (geb. Mörgenthaler)", details: {}, fatherId: 1001, motherId: 1002, childrenIds: [1019, 1020] },
            { id: 300, name: "Mareike Koller (geb. Maier)", details: { geboren: "18.11.1981" }, fatherId: 2004, motherId: 1004, spouseIds: [202], childrenIds: [301, 302, 303, 304] },
            { id: 1008, name: "Melanie Zimmermann (geb. Maier)", details: {}, fatherId: 2004, motherId: 1004, spouseIds: [1021], childrenIds: [1022, 1023, 1024, 1025] },
            { id: 1009, name: "Manuela Maier", details: {}, fatherId: 2004, motherId: 1004, spouseIds: [1026], childrenIds: [1027, 1028, 1029, 1030] },
            { id: 1010, name: "Maggy Maier", details: {}, fatherId: 2004, motherId: 1004, spouseIds: [1031], childrenIds: [1032, 1033, 1034] },
            { id: 1015, name: "Diethelm Mauthe", details: {} },
            { id: 1016, name: "Rose Mörgenthaler", details: {} },
            { id: 1017, name: "Bianca Mörgenthaler", details: {}, fatherId: 1006, motherId: 1016 },
            { id: 1018, name: "Lutz Mörgenthaler", details: {}, fatherId: 1006, motherId: 1016 },
            { id: 1019, name: "Svenja Koch", details: {}, fatherId: null, motherId: 1007, spouseIds: [1035], childrenIds: [1036, 1037, 1038, 1039] },
            { id: 1020, name: "Mario Koch", details: {}, fatherId: null, motherId: 1007 },
            { id: 1021, name: "Jörg Zimmermann", details: {} },
            { id: 1022, name: "Marlene Zimmermann", details: {}, fatherId: 1021, motherId: 1008 },
            { id: 1023, name: "Viktoria Zimmermann", details: {}, fatherId: 1021, motherId: 1008 },
            { id: 1024, name: "Julius Zimmermann", details: {}, fatherId: 1021, motherId: 1008 },
            { id: 1025, name: "Benjamin Zimmermann", details: {}, fatherId: 1021, motherId: 1008 },
            { id: 1026, name: "Sebastian Osswald", details: {} },
            { id: 1027, name: "Silas Osswald", details: {}, fatherId: 1026, motherId: 1009 },
            { id: 1028, name: "Lilith Osswald", details: {}, fatherId: 1026, motherId: 1009 },
            { id: 1029, name: "Eneas Osswald", details: {}, fatherId: 1026, motherId: 1009 },
            { id: 1030, name: "Salome Osswald", details: {}, fatherId: 1026, motherId: 1009 },
            { id: 1031, name: "Christoph Singer", details: {} },
            { id: 1032, name: "Minna Singer", details: {}, fatherId: 1031, motherId: 1010 },
            { id: 1033, name: "Romi Singer", details: {}, fatherId: 1031, motherId: 1010 },
            { id: 1034, name: "Hedi Singer", details: {}, fatherId: 1031, motherId: 1010 },
            { id: 1035, name: "Sven Schleifenbaum", details: {} },
            { id: 1036, name: "Noel Schleifenbaum", details: {}, fatherId: 1035, motherId: 1019 },
            { id: 1037, name: "Maileen Schleifenbaum", details: {}, fatherId: 1035, motherId: 1019 },
            { id: 1038, name: "Feline Schleifenbaum", details: {}, fatherId: 1035, motherId: 1019 },
            { id: 1039, name: "Elino Schleifenbaum", details: {}, fatherId: 1035, motherId: 1019 },

            // =================================================
            // ============ MAIER (WOLFGANG) FAMILY LINE =======
            // =================================================
            { id: 2000, name: "Ernst Maier", details: {}, spouseIds: [2001], childrenIds: [2003, 2002] },
            { id: 2001, name: "Berta Maier", details: {} },
            { id: 2002, name: "Wolfgang Maier", details: {}, fatherId: 2000, motherId: 2001, spouseIds: [1003], childrenIds: [2005, 2006] },
            { id: 2003, name: "Erwin Maier", details: {}, fatherId: 2000, motherId: 2001, spouseIds: [2007], childrenIds: [2008, 2009] },
            { id: 2004, name: "Rolf Maier", details: {}, spouseIds: [1004], childrenIds: [1008, 1009, 1010, 300] },
            { id: 2005, name: "Christof Maier", details: {}, fatherId: 2002, motherId: 1003, spouseIds: [2010], childrenIds: [2011, 2012, 2013] },
            { id: 2006, name: "Fabian Maier", details: {}, fatherId: 2002, motherId: 1003, spouseIds: [2014], childrenIds: [2015, 2016, 2017] },
            { id: 2007, name: "Elfriede Maier", details: {} },
            { id: 2008, name: "Sibylle", details: { info: "geb. Maier" }, fatherId: 2003, motherId: 2007, spouseIds: [2018], childrenIds: [2019, 2020] },
            { id: 2009, name: "Felix Maier", details: {}, fatherId: 2003, motherId: 2007, childrenIds: [2021] },
            { id: 2010, name: "Bärbel Maier", details: {} },
            { id: 2011, name: "Matthias Maier", details: {}, fatherId: 2005, motherId: 2010 },
            { id: 2012, name: "Simon Maier", details: {}, fatherId: 2005, motherId: 2010 },
            { id: 2013, name: "Katharina Maier", details: {}, fatherId: 2005, motherId: 2010 },
            { id: 2014, name: "Silke Maier", details: {} },
            { id: 2015, name: "Yannik Maier", details: {}, fatherId: 2006, motherId: 2014 },
            { id: 2016, name: "Tjorben Maier", details: {}, fatherId: 2006, motherId: 2014 },
            { id: 2017, name: "Lennart Maier", details: {}, fatherId: 2006, motherId: 2014 },
            { id: 2018, name: "Thorsten", details: {} },
            { id: 2019, name: "Anna", details: {}, fatherId: 2018, motherId: 2008 },
            { id: 2020, name: "Jakob", details: {}, fatherId: 2018, motherId: 2008 },
            { id: 2021, name: "Emil Maier", details: {}, fatherId: 2009 }
        ];

        // --- D3.js Visualization Code ---
        
        // Global variables
        let svg, g, zoom, detailPanel;
        let root, selectedNode, initialTransform;
        let showDetailPanelTimer, hideDetailPanelTimer;
        let maxDataDepth = 0;
        let verticalLayoutFromGeneration = 99; // 99 means disabled
        const allPeopleMap = new Map();
        const personToStammMap = new Map();
        let width = window.innerWidth;
        let height = window.innerHeight;
        
        // Define card dimensions for layout calculation
        const cardWidth = 180;
        const cardHeight = 70;

        const treeLayout = d3.tree()
            .nodeSize([cardHeight + 110, cardWidth + 160]) // Increased spacing
            .separation((a, b) => (a.parent === b.parent ? 1.1 : 1.3));


        // --- DATA PROCESSING ---

        function initializeMasterData() {
            allPeopleMap.clear();
            personToStammMap.clear();
            peopleData.forEach(p => {
                if (!p.details) p.details = {};
                allPeopleMap.set(p.id, { ...p, children: [], _children: [] });
                personToStammMap.set(p.id, []);
            });

            const rootIds = { koller: 1, holl: 205, moergenthaler: 1001, maier_wolfgang: 2000 };
            for (const [stammKey, rootId] of Object.entries(rootIds)) {
                const treeData = buildTreeFromFlatData(rootId, allPeopleMap);
                if (treeData) {
                    const hierarchy = d3.hierarchy(treeData);
                    hierarchy.each(node => {
                        const affiliations = personToStammMap.get(node.data.id);
                        if (affiliations && !affiliations.includes(stammKey)) {
                            affiliations.push(stammKey);
                        }
                    });
                }
            }
        }
        
        function buildTreeFromFlatData(rootId, personMap, visited = new Set()) {
            if (visited.has(rootId)) return null;
            visited.add(rootId);
            const rootPerson = personMap.get(rootId);
            if (!rootPerson) return null;
            const treeNode = JSON.parse(JSON.stringify(rootPerson));
            treeNode.children = [];
            if (rootPerson.childrenIds) {
                rootPerson.childrenIds.forEach(childId => {
                    const childNode = buildTreeFromFlatData(childId, personMap, new Set(visited));
                    if (childNode) treeNode.children.push(childNode);
                });
            }
            return treeNode;
        }

        function generateAhnentafel(startId, personMap) {
            const visited = new Set();
            function buildAncestors(personId) {
                if (!personId || visited.has(personId)) return null;
                visited.add(personId);
                const person = personMap.get(personId);
                if (!person) return null;
                const ahnenNode = { id: person.id, name: person.name, data: person, details: person.details, children: [] };
                const father = buildAncestors(person.fatherId);
                const mother = buildAncestors(person.motherId);
                if (father) ahnenNode.children.push(father);
                if (mother) ahnenNode.children.push(mother);
                return ahnenNode;
            }
            return buildAncestors(startId);
        }
        
        // --- VISUALIZATION SETUP ---

        function initializeVisualization() {
            d3.select("#tree-container").html('');
            
            svg = d3.select("#tree-container").append("svg")
                .attr("width", width)
                .attr("height", height)
                .on("click", () => {
                    selectedNode = null;
                    highlightBranch(null);
                    d3.select('#selection-info').html('');
                });

            g = svg.append("g");
            detailPanel = d3.select("#detail-panel")
                .on("mouseover", () => clearTimeout(hideDetailPanelTimer))
                .on("mouseout", () => { hideDetailPanelTimer = setTimeout(hideDetailPanel, 300); });

            zoom = d3.zoom()
                .scaleExtent([0.1, 3])
                .on("zoom", (event) => {
                    g.attr("transform", event.transform);
                    if (detailPanel.classed('visible')) {
                        if (selectedNode) positionDetailPanel(selectedNode);
                    }
                });

            svg.call(zoom);
        }
        
        // --- D3 UPDATE LOGIC ---
        
        function setTreeDepth(targetGen) {
            if (!root || targetGen < 0 || targetGen >= maxDataDepth) return;
            
            root.each(d => {
                if (d.depth < targetGen) {
                    if (d._children) { d.children = d._children; d._children = null; }
                } 
                else {
                    let allChildren = [];
                    if (d.children) allChildren = allChildren.concat(d.children);
                    if (d._children) allChildren = allChildren.concat(d._children);
                    if (allChildren.length > 0) { d._children = allChildren; d.children = null; }
                }
            });

            d3.select('#level-display').text(targetGen);
            update(root);
            // Wait for the transition to finish before zooming
            setTimeout(() => zoomToFit(), 550);
        }

        function findMaxDepth(node) {
            let max = 0;
            node.each(d => { if (d.depth > max) max = d.depth; });
            return max + 1;
        }

        function createNodeHTML(d) {
            const person = d.data;
            const name = person.name;
            const born = person.details.geboren || '?';
            const died = person.details.gestorben || 'Heute';
            
            return `<div class="w-full h-full p-3 flex flex-col items-center justify-center rounded-xl shadow-lg border border-slate-200 node-card">
                        <p class="font-bold text-slate-800 text-sm leading-tight text-center whitespace-normal break-words" title="${name}">${name}</p>
                        <p class="text-xs text-slate-500 mt-1">${born} - ${died}</p>
                    </div>`;
        }
        
        function update(source) {
            const duration = 500;
            let treeData = treeLayout(root);

            // This block overrides the D3 layout for vertical sections.
            if (verticalLayoutFromGeneration < 99) {
                root.each(node => {
                    // Find each parent node that triggers the vertical layout
                    if (node.depth === verticalLayoutFromGeneration - 1 && node.children) {
                        let yCounter = node.y + cardHeight + 150; // Start position for the first child
                        
                        // This recursive function will position all descendants in a vertical stack
                        function positionDescendants(currentNode, xPosition) {
                            currentNode.x = xPosition;
                            currentNode.y = yCounter;
                            yCounter += cardHeight + 110; // Spacing for the next node

                            if (currentNode.children) {
                                // Grandchildren are indented further
                                currentNode.children.forEach(child => positionDescendants(child, xPosition + 60)); 
                            }
                        }

                        // Start the process for each direct child of the trigger node
                        node.children.forEach(child => {
                            positionDescendants(child, node.x + cardWidth + 100);
                        });
                    }
                });
            }


            let nodes = treeData.descendants();
            let links = treeData.links();

            const node = g.selectAll("g.node").data(nodes, d => d.data.id || d.data.name);

            const nodeEnter = node.enter().append("g")
                .attr("class", "node")
                .attr("transform", d => `translate(${source.x0 || source.x},${source.y0 || source.y})`)
                .on("click", (event, d) => {
                    event.stopPropagation();
                    clearTimeout(showDetailPanelTimer);
                    hideDetailPanel();
                    centerOnNode(d);
                    if (d.children) {
                        d._children = d.children;
                        d.children = null;
                        d3.select('#level-display').text(d.depth);
                    } 
                    else if (d._children) {
                        d.children = d._children;
                        d._children = null;
                        d.children.forEach(child => {
                            let allGrandChildren = [];
                            if (child.children) allGrandChildren = allGrandChildren.concat(child.children);
                            if (child._children) allGrandChildren = allGrandChildren.concat(child._children);
                            if(allGrandChildren.length > 0) { child._children = allGrandChildren; child.children = null; }
                        });
                        d3.select('#level-display').text(d.depth + 1);
                    }
                    update(d);
                })
                .on("mouseover", (event, d) => {
                    clearTimeout(hideDetailPanelTimer);
                    clearTimeout(showDetailPanelTimer);
                    showDetailPanelTimer = setTimeout(() => {
                        selectedNode = d; // Set selectedNode for panel positioning
                        showDetailPanel(d);
                    }, 500); // 500ms delay
                })
                .on("mouseout", () => {
                    clearTimeout(showDetailPanelTimer);
                    hideDetailPanelTimer = setTimeout(hideDetailPanel, 300);
                });

            nodeEnter.append("foreignObject")
                .attr("width", cardWidth)
                .attr("height", cardHeight)
                .attr("x", -cardWidth / 2)
                .attr("y", -cardHeight / 2)
                .style("overflow", "visible")
                .html(d => createNodeHTML(d));

            const nodeUpdate = nodeEnter.merge(node);
            nodeUpdate.transition().duration(duration).attr("transform", d => `translate(${d.x},${d.y})`);
            
            nodeUpdate.select("foreignObject").html(d => createNodeHTML(d));

            const nodeExit = node.exit().transition().duration(duration)
                .attr("transform", d => `translate(${source.x},${source.y})`).remove();
            nodeExit.select("foreignObject").style("opacity", 1e-6);

            const link = g.selectAll("path.link").data(links, d => d.target.data.id || d.target.data.name);

            const linkEnter = link.enter().insert("path", "g")
                .attr("class", "link")
                .attr("d", d => {
                    const o = { x: source.x0 || source.x, y: source.y0 || source.y};
                    return elbow(o, o);
                });

            linkEnter.merge(link).transition().duration(duration)
                .attr("d", d => {
                    if (d.target.depth >= verticalLayoutFromGeneration) { return verticalElbow(d.source, d.target); }
                    return elbow(d.source, d.target);
                });

            link.exit().transition().duration(duration)
                .attr("d", d => {
                    const o = { x: source.x, y: source.y };
                    return elbow(o, o);
                }).remove();
            
            highlightBranch(selectedNode);
            nodes.forEach(d => { d.x0 = d.x; d.y0 = d.y; });
        }
        
        function elbow(s, d) {
            const sourceY = s.y + cardHeight / 2;
            const targetY = d.y - cardHeight / 2;
            return `M${s.x},${sourceY}V${(sourceY + targetY) / 2}H${d.x}V${targetY}`;
        }
        
        function verticalElbow(s, d) {
             return `M${s.x},${s.y + cardHeight / 2} V${d.y} H${d.x - cardWidth / 2}`;
        }

        function highlightBranch(d) {
            d3.selectAll('.node').classed('highlight descendant-highlight ancestor-highlight', false);
            d3.selectAll('.link').classed('descendant-highlight ancestor-highlight', false);
            if (!d) return;
            const ancestors = d.ancestors();
            const ancestorIds = new Set(ancestors.map(n => n.data.id));
            const descendantNodes = d.descendants();
            const descendantIds = new Set(descendantNodes.map(n => n.data.id));
            d3.selectAll('.node').each(function(node_d) {
                if(!node_d.data.id) return;
                const gNode = d3.select(this);
                gNode.classed('highlight', node_d.data.id === d.data.id);
                gNode.classed('descendant-highlight', descendantIds.has(node_d.data.id) && node_d.data.id !== d.data.id);
                gNode.classed('ancestor-highlight', ancestorIds.has(node_d.data.id) && node_d.data.id !== d.data.id);
            });
            d3.selectAll('.link').each(function(link_d) {
                if(!link_d.source.data.id || !link_d.target.data.id) return;
                const isDescendantLink = descendantIds.has(link_d.source.data.id) && descendantIds.has(link_d.target.data.id);
                const isAncestorLink = ancestorIds.has(link_d.source.data.id) && ancestorIds.has(link_d.target.data.id);
                d3.select(this).classed('descendant-highlight', isDescendantLink);
                d3.select(this).classed('ancestor-highlight', isAncestorLink);
            });
        }

        // --- UTILITY FUNCTIONS ---
        
        /**
         * Recursively collects all visible nodes (nodes that are not collapsed).
         * @param {object} node The starting d3 hierarchy node.
         * @returns {Array} A flat array of visible node objects.
         */
        function getVisibleNodes(node) {
            let nodes = [];
            function recurse(n) {
                nodes.push(n);
                if (n.children) {
                    n.children.forEach(recurse);
                }
            }
            recurse(node);
            return nodes;
        }

        function zoomToFit(duration = 750) {
            const topOffset = 80; // Estimated height of the header area in pixels
            const visibleNodes = getVisibleNodes(root);
            if (visibleNodes.length === 0) return;

            const minX = d3.min(visibleNodes, d => d.x - cardWidth / 2);
            const maxX = d3.max(visibleNodes, d => d.x + cardWidth / 2);
            const minY = d3.min(visibleNodes, d => d.y - cardHeight / 2);
            const maxY = d3.max(visibleNodes, d => d.y + cardHeight / 2);

            const boundsWidth = maxX - minX;
            const boundsHeight = maxY - minY;
            
            if(boundsWidth <= 0 || boundsHeight <= 0) return;

            const midX = minX + boundsWidth / 2;
            const midY = minY + boundsHeight / 2;
            
            const padding = 1.2; // Add 20% padding
            
            // Calculate scale based on the available drawing area (full width, height minus offset)
            const availableHeight = height - topOffset;
            const scale = Math.min(width / (boundsWidth * padding), availableHeight / (boundsHeight * padding));
            
            // Center the content in the visible area
            const translateX = width / 2 - midX * scale;
            const translateY = (availableHeight / 2 + topOffset) - midY * scale;

            const transform = d3.zoomIdentity.translate(translateX, translateY).scale(scale);
            
            if(!isFinite(scale) || isNaN(translateX) || isNaN(translateY)) {
                console.warn("zoomToFit produced invalid transform. Skipping.");
                return;
            }

            svg.transition().duration(duration).call(zoom.transform, transform);
        }

        // --- EVENT HANDLERS ---
        
        function centerOnNode(d) {
            const scale = 0.6;
            const translateX = width / 2 - d.x * scale;
            const translateY = height / 2 - d.y * scale;
            const transform = d3.zoomIdentity.translate(translateX, translateY).scale(scale);
            svg.transition().duration(750).call(zoom.transform, transform);
            selectedNode = d;
            highlightBranch(d);
            showDetailPanel(d);
            d3.select('#selection-info')
              .html(`<span class="font-semibold text-slate-500">Selektion: </span><span class="font-bold text-sky-600">${d.data.name} (Gen. ${d.depth})</span>`);
        }

        function handleSearch(event) {
            const inputElement = d3.select(this).node();
            const value = inputElement.value.toLowerCase();
            const resultsContainer = d3.select('.search-results');
            resultsContainer.html('');
            const currentView = d3.select('.view-btn.active').attr('data-view');
            if (value.length < 2) return;
            const results = [];
            const addedIds = new Set(); 
            peopleData
                .filter(p => p.name.toLowerCase().includes(value))
                .forEach(p => {
                    if (currentView === 'ahnentafel') {
                        if (addedIds.has(p.id)) return;
                        addedIds.add(p.id);
                        results.push({
                            displayName: `${p.name} (*${p.details.geboren ? p.details.geboren.split('.').pop().trim() : '?'})`,
                            targetId: p.id,
                            targetStamm: 'ahnentafel'
                        });
                    } else {
                        const affiliations = personToStammMap.get(p.id) || [];
                        affiliations.forEach(stamm => {
                            const stammLabel = stamm.charAt(0).toUpperCase() + stamm.slice(1).replace('_', ' ');
                            results.push({
                                displayName: `${p.name} (*${p.details.geboren ? p.details.geboren.split('.').pop().trim() : '?'}, Stamm ${stammLabel})`,
                                targetId: p.id,
                                targetStamm: stamm
                            });
                        });
                    }
                });
            results.forEach(res => {
                resultsContainer.append('div')
                    .attr('class', 'search-result-item')
                    .text(res.displayName)
                    .on('click', () => {
                        navigateToPerson(res.targetId, res.targetStamm);
                        resultsContainer.html('');
                        inputElement.value = '';
                    });
            });
        }
        
        function handleReset() {
            d3.select('#selection-info').html('');
            selectedNode = null;
            highlightBranch(null);
            setTreeDepth(1); // This will now also trigger zoomToFit
        }
        
        function findAndShowPerson(personId) {
            const currentView = d3.select('.view-btn.active').attr('data-view');
            const rootIds = { koller: 1, holl: 205, moergenthaler: 1001, maier_wolfgang: 2000 };
            const fullData = buildTreeFromFlatData(rootIds[currentView], allPeopleMap);
            if (!fullData) return;
            const fullHierarchy = d3.hierarchy(fullData, d => d.children);
            let targetNodeInFullHierarchy = null;
            fullHierarchy.each(node => { if (node.data.id === personId) { targetNodeInFullHierarchy = node; } });
            if (targetNodeInFullHierarchy) {
                const pathIds = new Set(targetNodeInFullHierarchy.ancestors().map(d => d.data.id));
                root.each(d => {
                    if (d.children && !pathIds.has(d.data.id)) { d._children = d.children; d.children = null; } 
                    else if (pathIds.has(d.data.id)) { if (d._children) { d.children = d._children; d._children = null; } }
                });
                let targetNodeInVisibleTree = null;
                root.each(d => { if (d.data.id === personId) { targetNodeInVisibleTree = d; } });
                if (targetNodeInVisibleTree) {
                    update(root);
                    const animationDuration = 500;
                    setTimeout(() => { centerOnNode(targetNodeInVisibleTree); }, animationDuration + 100);
                }
            } else { console.warn(`Node with ID ${personId} could not be found.`); }
        }
        
        // --- NAVIGATION LOGIC ---
        function navigateToPerson(personId, targetStamm = null) {
            hideDetailPanel();
            const currentView = d3.select('.view-btn.active').attr('data-view');
            if (targetStamm === 'ahnentafel') {
                const ahnentafelData = generateAhnentafel(personId, allPeopleMap);
                if (ahnentafelData) { renderTree('ahnentafel', ahnentafelData, personId); }
                return;
            }
            if (targetStamm) {
                if (currentView !== targetStamm) { renderTree(targetStamm, null, personId); } 
                else { findAndShowPerson(personId); }
            }
        }

        // --- DETAIL PANEL LOGIC ---
        
        function positionDetailPanel(d) {
            if (!d) return;
            const transform = d3.zoomTransform(svg.node());
            const [tx, ty] = transform.apply([d.x, d.y]);
            const panelWidth = 350;
            const panelHeight = detailPanel.node().getBoundingClientRect().height;
            const margin = 15; // Reduced margin for closer positioning
            let finalX = tx + (cardWidth / 2) * transform.k + margin;
            let finalY = ty - panelHeight / 2;
            
            // Adjust if panel goes off-screen
            if (finalX + panelWidth + margin > window.innerWidth) { finalX = tx - ((cardWidth / 2) * transform.k) - panelWidth - margin; }
            if (finalY + panelHeight + margin > window.innerHeight) { finalY = window.innerHeight - panelHeight - margin; }
            if (finalY < margin) { finalY = margin; }
            
            detailPanel.style('left', `${finalX}px`).style('top', `${finalY}px`);
        }

        function showDetailPanel(d) {
            const person = allPeopleMap.get(d.data.id);
            if (!person) return;
            const stammLinks = (personToStammMap.get(person.id) || [])
                .map(stamm => `<span class="detail-link" data-id="${person.id}" data-stamm="${stamm}">${stamm.charAt(0).toUpperCase() + stamm.slice(1).replace('_', ' ')}</span>`)
                .join(', ');
            let panelHTML = `<div class="p-6"><div class="flex items-center space-x-6"><img class="h-24 w-24 rounded-full object-cover ring-4 ring-sky-100" src="https://placehold.co/100x100/e0f2fe/0c4a6e?text=${person.name.charAt(0)}" alt="Platzhalterbild" onerror="this.onerror=null;this.src='https://placehold.co/100x100/e0f2fe/0c4a6e?text=Foto';"><div><h3 class="text-2xl font-bold text-slate-800">${person.name}</h3><p class="text-slate-500 font-medium">Stamm ${stammLinks || 'Unbekannt'}</p></div></div><div class="mt-6 border-t border-slate-200 pt-6"><dl class="space-y-3 text-sm">`;
            if (person.details.geboren) panelHTML += `<div class="flex"><dt class="w-24 font-medium text-slate-500 flex-shrink-0">Geboren</dt><dd class="text-slate-700">${person.details.geboren}</dd></div>`;
            if (person.details.gestorben) panelHTML += `<div class="flex"><dt class="w-24 font-medium text-slate-500 flex-shrink-0">Gestorben</dt><dd class="text-slate-700">${person.details.gestorben}</dd></div>`;
            if (person.spouseIds && person.spouseIds.length > 0) {
                const spouses = person.spouseIds.map(id => allPeopleMap.get(id)).filter(Boolean);
                panelHTML += `<div class="flex"><dt class="w-24 font-medium text-slate-500 flex-shrink-0">Partner</dt><dd class="text-slate-700">${spouses.map(s => `<span class="detail-link" data-id="${s.id}" data-stamm="${(personToStammMap.get(s.id) || [])[0]}">${s.name}</span>`).join('<br>')}</dd></div>`;
            }
            if (person.details.info) panelHTML += `<div class="flex"><dt class="w-24 font-medium text-slate-500 flex-shrink-0">Info</dt><dd class="text-slate-700">${person.details.info}</dd></div>`;
            panelHTML += `</dl>`;
            if (person.fatherId || person.motherId) {
                panelHTML += `<div class="mt-4 border-t border-slate-200 pt-4"><h4 class="text-sm font-medium text-slate-500 mb-2">Eltern</h4><dl class="space-y-3 text-sm">`;
                if(person.fatherId) {
                    const father = allPeopleMap.get(person.fatherId);
                    if (father) panelHTML += `<div class="flex"><dt class="w-24 font-medium text-slate-400 flex-shrink-0">Vater</dt><dd class="text-slate-700"><span class="detail-link" data-id="${father.id}" data-stamm="${(personToStammMap.get(father.id) || [])[0]}">${father.name}</span></dd></div>`;
                }
                if(person.motherId) {
                    const mother = allPeopleMap.get(person.motherId);
                    if (mother) panelHTML += `<div class="flex"><dt class="w-24 font-medium text-slate-400 flex-shrink-0">Mutter</dt><dd class="text-slate-700"><span class="detail-link" data-id="${mother.id}" data-stamm="${(personToStammMap.get(mother.id) || [])[0]}">${mother.name}</span></dd></div>`;
                }
                panelHTML += `</dl></div>`;
            }
            panelHTML += `</div><div class="p-6 bg-slate-50 rounded-b-xl border-t border-slate-200 flex justify-between text-sm font-medium text-sky-600 space-x-4"><a href="#" class="hover:underline detail-link" data-action="ahnentafel" data-id="${person.id}">Ahnentafel zeigen</a></div>`;
            detailPanel.html(panelHTML);
            detailPanel.classed('visible', true);
            positionDetailPanel(d); // Position after content is set and panel is visible
            detailPanel.selectAll('.detail-link').on('click', function(event) {
                event.preventDefault();
                event.stopPropagation();
                const targetId = parseInt(this.dataset.id);
                const action = this.dataset.action;
                const targetStamm = this.dataset.stamm;
                if (action === 'ahnentafel') { navigateToPerson(targetId, 'ahnentafel'); } 
                else { navigateToPerson(targetId, targetStamm); }
            });
        }

        function hideDetailPanel() {
            if (detailPanel) { detailPanel.classed('visible', false); }
        }
        
        // --- UI CONTROLS INITIALIZATION ---
        function initializeControls() {
            d3.selectAll('.view-btn').on('click', function() { renderTree(this.dataset.view); });
            d3.select('#search-input').on('input', handleSearch);
            d3.select('#level-plus-button').on('click', () => {
                const currentGen = parseInt(d3.select('#level-display').text());
                setTreeDepth(currentGen + 1);
            });
            d3.select('#level-minus-button').on('click', () => {
                const currentGen = parseInt(d3.select('#level-display').text());
                setTreeDepth(currentGen - 1);
            });
            d3.select('#reset-button').on('click', handleReset);
            
            // REVISED: Vertical Layout Controls
            const verticalToggleButton = d3.select('#vertical-toggle-button');
            const verticalIconX = d3.select('#vertical-icon-x');
            const verticalIconCheck = d3.select('#vertical-icon-check');
            const verticalControlsContainer = d3.select('#vertical-controls-container');

            verticalToggleButton.on('click', () => {
                const isCurrentlyActive = !verticalControlsContainer.classed('hidden');

                if (isCurrentlyActive) { // It's ON, let's turn it OFF
                    verticalIconCheck.classed('hidden', false); // Show check (activate icon)
                    verticalIconX.classed('hidden', true);     // Hide X (deactivate icon)
                    verticalControlsContainer.classed('hidden', true); // Hide controls
                    verticalLayoutFromGeneration = 99;
                } else { // It's OFF, let's turn it ON
                    verticalIconCheck.classed('hidden', true);     // Hide check
                    verticalIconX.classed('hidden', false);    // Show X
                    verticalControlsContainer.classed('hidden', false); // Show controls
                    // The highest generation that can be a parent is maxDataDepth - 2
                    // For a tree of depth 5 (maxDataDepth=6), this would be generation 4.
                    verticalLayoutFromGeneration = maxDataDepth - 2; 
                    if (verticalLayoutFromGeneration < 0) verticalLayoutFromGeneration = 0;
                    d3.select('#vertical-display').text(verticalLayoutFromGeneration);
                }
                update(root);
            });

            d3.select('#vertical-plus-button').on('click', () => {
                let currentVal = parseInt(d3.select('#vertical-display').text());
                // You can't set a generation vertical if it's the last or second to last one.
                if (isNaN(currentVal) || currentVal >= maxDataDepth - 2) return;
                verticalLayoutFromGeneration = currentVal + 1;
                d3.select('#vertical-display').text(verticalLayoutFromGeneration);
                update(root);
            });

            d3.select('#vertical-minus-button').on('click', () => {
                let currentVal = parseInt(d3.select('#vertical-display').text());
                if (isNaN(currentVal) || currentVal <= 0) return;
                verticalLayoutFromGeneration = currentVal - 1;
                d3.select('#vertical-display').text(verticalLayoutFromGeneration);
                update(root);
            });

            const fabToggle = document.getElementById('fab-toggle');
            const fabOptions = document.getElementById('cockpit-options');
            const fabIconOpen = document.getElementById('fab-icon-open');
            const fabIconClose = document.getElementById('fab-icon-close');
            fabToggle.addEventListener('click', () => {
                fabOptions.classList.toggle('opacity-0');
                fabOptions.classList.toggle('translate-y-4');
                fabOptions.classList.toggle('pointer-events-none');
                fabIconOpen.classList.toggle('hidden');
                fabIconClose.classList.toggle('hidden');
            });
        }

        // --- MAIN RENDER FUNCTION ---

        function renderTree(viewKey, customData = null, targetIdToSelect = null) {
            let data, title;
            const rootIds = { koller: 1, holl: 205, moergenthaler: 1001, maier_wolfgang: 2000 };
            const titles = { koller: "Stammbaum Familie Koller", holl: "Stammbaum Familie Holl", moergenthaler: "Stammbaum Familie Mörgenthaler", maier_wolfgang: "Stammbaum Maier (Wolfgang)", ahnentafel: "Ahnentafel" };
            initializeVisualization();
            hideDetailPanel();
            if (viewKey === 'ahnentafel') {
                const startPersonId = customData ? customData.id : (selectedNode ? selectedNode.data.id : 202);
                data = customData || generateAhnentafel(startPersonId, allPeopleMap);
                title = `Ahnentafel für ${data.name}`;
            } else {
                data = buildTreeFromFlatData(rootIds[viewKey], allPeopleMap);
                title = titles[viewKey];
            }
            d3.select('#main-title').text(title);
            selectedNode = null;
            d3.select('#selection-info').html('');
            if (!data) {
                g.append("text").attr("x", width/2).attr("y", height/2).attr("text-anchor", "middle").text("Daten für diese Ansicht nicht verfügbar.");
                return;
            }
            root = d3.hierarchy(data, d => d.children);
            maxDataDepth = findMaxDepth(root);
            d3.selectAll('.view-btn').classed('active', false).classed('bg-slate-100', true);
            d3.selectAll('.view-btn-ahnen').classed('active', false);
            const activeButton = d3.select(`.view-btn[data-view="${viewKey}"]`);
            activeButton.classed('active', true).classed('bg-slate-100', false);
            if(viewKey === 'ahnentafel') d3.select('.view-btn-ahnen').classed('active', true);
            root.x0 = width / 2;
            root.y0 = 0;
            
            // Reset vertical layout controls to default OFF state
            verticalLayoutFromGeneration = 99;
            d3.select('#vertical-icon-check').classed('hidden', false);
            d3.select('#vertical-icon-x').classed('hidden', true);
            d3.select('#vertical-controls-container').classed('hidden', true);

            setTreeDepth(1);
            
            if (targetIdToSelect) {
                setTimeout(() => {
                    if (viewKey === 'ahnentafel') { 
                        centerOnNode(root); 
                    } else { 
                        findAndShowPerson(targetIdToSelect); 
                    }
                }, 550);
            }
        }

        // --- Initial Setup ---
        initializeMasterData();
        initializeControls();
        renderTree('koller');

        window.addEventListener('resize', () => {
            width = window.innerWidth;
            height = window.innerHeight;
            const currentView = d3.select('.view-btn.active').attr('data-view');
            renderTree(currentView);
        });

    </script>
</body>
</html>
